<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love ‚Äî Criador de Prompts</title>
  <meta name="theme-color" content="#F5C400" />
  <meta name="description" content="direito.love ‚Äî Criador de Prompts para estudo jur√≠dico, OAB e concursos." />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />

  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:12px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --snap-offset: 96px;

      /* Bot√µes (mesmo padr√£o da /pesquisa) */
      --btn-pad-y: 6px;
      --btn-pad-x: 10px;
      --btn-font: 12.5px;
      --btn-min-h: 34px;
      --btn-min-w: 96px;

      --success:#16a34a;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:400 13.5px/1.45 var(--font);}

    /* Topbar */
    .topbar{position:sticky; top:0; z-index:100; background:var(--highlight); border-bottom:1px solid rgba(0,0,0,.08)}
    .topbar__inner{max-width:1160px; margin:0 auto; padding:8px 12px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#111}
    .brand__logo{height:32px}
    .chip{
      padding:6px 10px; border-radius:8px; background:#fff; border:1px solid var(--border);
      font-size:12.5px; color:#102A71; text-decoration:none; font-weight:600; transition:.15s
    }
    .chip:hover{background:var(--highlight-light)}

    /* Layout leve (sem ‚Äúcaixa‚Äù de fundo) */
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    h2{margin:0 0 12px;color:var(--primary);font-size:20px}

    /* Tema */
    label[for=tema]{display:block; margin:10px 0 6px; color:var(--primary); font-weight:700}
    #tema{
      width:100%; min-height:110px; resize:vertical;
      border:2px solid var(--primary); border-radius:10px; background:#fff; color:#001840;
      padding:10px 12px; font-size:14px; outline:none;
    }
    #tema::placeholder{color:#9aa3af}

    /* Aviso abaixo do tema (ap√≥s 3s de digita√ß√£o) */
    .notice{
      display:none; margin:8px 0 10px;
      background:#fff7d6; border:1px solid #f3dd94; color:#5b4400;
      padding:8px 12px; border-radius:10px; font-weight:600;
    }
    .notice.show{ display:block; }

    /* Categorias (acorde√µes) */
    #categorias{ margin-top: 10px; }
    .cat{
      background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow);
      margin:12px 0; overflow:hidden; scroll-margin-top: var(--snap-offset);
    }
    .cat > summary{
      list-style:none; cursor:pointer; padding:10px 14px; font-weight:800; color:#102A71;
      display:flex; align-items:center; justify-content:space-between;
    }
    .cat > summary::-webkit-details-marker{ display:none; }
    .cat[open] > summary{ background:#fff7d6; }
    .cat-count{ font-weight:700; background:#0f172a0d; color:#0f172a; padding:2px 8px; border-radius:999px; font-size:12px; }

    /* Cards das op√ß√µes ‚Äî bot√£o √† direita */
    .option-card{
      background:#fff; border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow);
      padding:12px 14px; margin:10px 0;
      display:grid; grid-template-columns: 1fr auto; column-gap:10px; align-items:start;
    }
    .opt-title{grid-column:1; margin:0 0 6px 0; font-weight:700; color:#0f172a}
    .opt-desc{grid-column:1; margin:0; color:#1f2937}
    .opt-actions{grid-column:2; margin:0; justify-self:end; align-self:start; display:flex}

    .btn, .btn-ghost, .btn-alt{
      padding:var(--btn-pad-y) var(--btn-pad-x); border-radius:8px; font-size:var(--btn-font);
      min-height:var(--btn-min-h); min-width:var(--btn-min-w); cursor:pointer; transition:.15s;
    }
    .btn{appearance:none;border:1px solid var(--border);background:var(--highlight);color:#000;}
    .btn:hover{background:var(--highlight-light)}
    .btn-alt{appearance:none;border:1px solid #0f2a71;background:var(--primary);color:#fff;}
    .btn-alt:hover{background:#264399}
    .btn-alt.is-selected{ background: var(--success); color:#fff; border-color:#168a44; }
    .btn-alt.is-selected:hover{ filter:brightness(.95); }
    .btn-ghost{appearance:none;border:1px solid var(--border);background:#fff;color:#111;}
    .btn-ghost:hover{background:#f2f4f7}
    .btn.success{ background: var(--success); color:#fff; border:1px solid #168a44; }
    .btn.success:hover{ filter:brightness(.96); }

    /* Pr√©via */
    .preview{ margin:16px 0 6px; display:none; }
    .preview h3{ margin:0 0 6px; color:#102A71; font-size:16px }
    #saida{ width:100%; min-height:30vh; resize:vertical; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:#fff; color:#001840; font: 13.5px/1.45 ui-monospace, Menlo, Consolas, monospace; }

    /* Barra fixa de a√ß√µes */
    #ix-bar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(12px + var(--safe-bottom)); z-index:9999; background:#111; color:#fff;
      padding:10px 12px; border-radius:12px; display:none; align-items:center; gap:8px; flex-wrap:wrap;
      box-shadow:0 6px 20px rgba(0,0,0,.25); font: 600 13px/1 var(--font);
      pointer-events:none;
    }
    #ix-bar button{
      border:0; padding:var(--btn-pad-y) var(--btn-pad-x); border-radius:10px; cursor:pointer; pointer-events:auto;
      font-size:var(--btn-font); min-height:var(--btn-min-h);
    }
    #ix-primary.btn{ background:var(--primary); color:#fff; border:1px solid #0f2a71; }
    #ix-primary.btn:hover{ background:#264399; }
    #ix-primary.success{ background: var(--success); border-color:#168a44; }
    #ix-secondary{ background:#e5e7eb; color:#111; }
    #ix-secondary:hover{ background:#d6dae1; }
    #ix-bar[aria-hidden="true"]{ display:none; }

    /* Chips de IA */
    .ia-tray{ display:none; align-items:center; gap:8px; flex-wrap:wrap; pointer-events:auto; }
    .ia-chip{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:#fff; border:1px solid var(--border); color:#102A71; font-weight:700; font-size:12px;
      text-decoration:none; cursor:pointer;
    }
    .ia-chip:hover{ background:#f2f4f7; }
    .ia-close{ padding:6px 10px; border-radius:8px; border:1px solid var(--border); background:#fff; color:#111; cursor:pointer; }

    /* Toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;
      padding:8px 12px;border-radius:999px;opacity:0;transition:.2s;z-index:2000}
    .toast.show{opacity:1}

    /* Mobile: descri√ß√µes menores */
    @media (max-width: 600px){
      .opt-desc{ font-size:11.5px; line-height:1.35; }
      .option-card{ padding:10px 12px; }
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <a class="brand" href="index.html" aria-label="In√≠cio">
        <img class="brand__logo" src="icons/logo.png" alt="direito.love" />
      </a>
      <nav class="topbar__actions" aria-label="A√ß√µes">
        <a class="chip" href="index.html" aria-current="page">Prompt</a>
        <a class="chip" href="pesquisa.html">Pesquisar</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <h2>Criador de Prompts para Estudantes de Direito</h2>

    <label for="tema">Digite o tema ou utilize a pesquisa para encontrar:</label>
    <textarea id="tema" placeholder="Ex.: Responsabilidade civil por erro m√©dico no atendimento de emerg√™ncia ‚Äî art. 37, ¬ß6¬∫, CF; CDC; jurisprud√™ncia do STJ..."></textarea>

    <!-- Aviso abaixo do tema (aparece 3s ap√≥s come√ßar a digitar) -->
    <div id="importNotice" class="notice">Tema definido. Agora selecione as sess√µes do seu prompt.</div>

    <!-- Categorias -->
    <section id="categorias"></section>

    <!-- Pr√©via do Prompt -->
    <div class="preview" id="preview">
      <h3>Pr√©via do Prompt</h3>
      <textarea id="saida" readonly placeholder="(vazio)"></textarea>
    </div>
  </div>

  <!-- Barra fixa de a√ß√µes -->
  <div id="ix-bar" aria-hidden="true" aria-live="polite">
    <div id="ix-buttons" style="display:flex; align-items:center; gap:8px;">
      <button id="ix-primary" class="btn">Gerar Prompt</button>
      <button id="ix-secondary" class="btn-ghost">Limpar</button>
    </div>
    <div id="ix-chips" class="ia-tray" aria-hidden="true"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const toast=(m,t=1600)=>{const el=$("#toast");el.textContent=m;el.classList.add("show");setTimeout(()=>el.classList.remove("show"),t);};
  const showNotice=(on)=>$('#importNotice').classList.toggle('show', !!on);

  /* ===== CATS & DIRECTIVES ===== */
  const CATS = [
    { id:'fund', label:'Fundamentos', items:[
      {id:'conceitos', label:'Conceitos e Defini√ß√µes', desc:'Defini√ß√µes objetivas, linguagem clara e diferencia√ß√µes essenciais, com 1‚Äì2 exemplos curtos.'},
      {id:'base-legal', label:'Base Legal Essencial', desc:'Listar artigos pertinentes (n¬∫ + ementa curt√≠ssima) e diplomas aplic√°veis. Sem transcri√ß√£o integral.'},
      {id:'doutrina', label:'Doutrina Relevante', desc:'S√≠ntese de 2‚Äì3 autores e suas posi√ß√µes. Refer√™ncia bibliogr√°fica abreviada.'},
    ]},
    { id:'precedentes', label:'Precedentes e Enunciados', items:[
      {id:'juris-maj', label:'Jurisprud√™ncia Majorit√°ria', desc:'Tese dominante (STJ/STF) + 2‚Äì4 precedentes (n√∫mero + ideia central).'},
      {id:'sumulas', label:'S√∫mulas e Enunciados', desc:'S√∫mulas/Enunciados relevantes (n¬∫ + tese) ‚Äî STF/STJ/TSE/FPPC/CJF.'},
      {id:'leading', label:'Casos Famosos / Leading Cases', desc:'3‚Äì5 casos paradigm√°ticos e a contribui√ß√£o de cada um.'},
    ]},
    { id:'analise', label:'An√°lise e Estrat√©gia', items:[
      {id:'raciocinio', label:'Racioc√≠nio Jur√≠dico (passo a passo)', desc:'Fluxo l√≥gico (if/then) para resolver o caso, com premissas e conclus√£o.'},
      {id:'quadro-comp', label:'Quadro Comparativo', desc:'Tabela simples: crit√©rios x alternativas, vantagens/risco/efeito.'},
      {id:'debates', label:'Debates, Cr√≠ticas e Tend√™ncias', desc:'Controv√©rsias, cr√≠ticas doutrin√°rias e tend√™ncias jurisprudenciais.'},
      {id:'atualiz', label:'Atualiza√ß√µes Recentes', desc:'Mudan√ßas relevantes (√∫ltimos 12‚Äì24 meses) ‚Äî leis e julgados.'},
      {id:'erros', label:'Erros Comuns', desc:'Armadilhas e confus√µes frequentes; como evitar.'},
    ]},
    { id:'pratica', label:'Pr√°tica Processual', items:[
      {id:'modelo', label:'Estrutura de Pe√ßa / Modelos', desc:'Esqueleto com se√ß√µes obrigat√≥rias e frases-modelo edit√°veis.'},
      {id:'check-peca', label:'Checklist de Pe√ßa', desc:'Checklist antes de protocolar: requisitos formais e materiais.'},
      {id:'casos', label:'Exemplos e Casos Pr√°ticos', desc:'Cen√°rios hipot√©ticos curtos mostrando aplica√ß√£o do direito.'},
    ]},
    { id:'estudo', label:'Estudo & Provas', items:[
      {id:'mapa', label:'Mapa Mental', desc:'Organograma textual (bullets hier√°rquicos) do tema.'},
      {id:'flash', label:'Flashcards', desc:'Cart√µes Q/A curtos para memoriza√ß√£o.'},
      {id:'questoes', label:'Quest√µes de Fixa√ß√£o', desc:'5‚Äì10 quest√µes objetivas/discursivas; gabarito ao final.'},
      {id:'check-final', label:'Checklist Final de Revis√£o', desc:'Checklist r√°pido para revis√£o pr√©-prova.'},
      {id:'dicas', label:'Dicas de Prova (OAB/Concursos)', desc:'Estrat√©gias, pegadinhas t√≠picas e gest√£o de tempo.'},
    ]},
    { id:'refs', label:'Refer√™ncias', items:[
      {id:'bibliog', label:'Refer√™ncias Bibliogr√°ficas', desc:'Lista comentada de obras e artigos para aprofundar.'},
    ]},
  ];

  const DIRECTIVES = {
    'conceitos':'Fa√ßa defini√ß√µes diretas, compare com institutos pr√≥ximos e ilustre com 1‚Äì2 exemplos breves.',
    'base-legal':'Liste artigos (n¬∫ + ementa curt√≠ssima) e diplomas; evite transcrever integral. Cite se√ß√µes espec√≠ficas quando √∫til.',
    'doutrina':'Resuma 2‚Äì3 posi√ß√µes doutrin√°rias com refer√™ncia abreviada (Autor, Obra, ano/p√°gina quando poss√≠vel).',
    'juris-maj':'Traga a tese dominante (STJ/STF) e 2‚Äì4 julgados com n√∫mero e ideia central, em bullets.',
    'sumulas':'Liste s√∫mulas/enunciados relevantes com n¬∫ e tese, agrupando por tribunal/comiss√£o.',
    'leading':'Selecione 3‚Äì5 leading cases; para cada um: contexto, holding e impacto.',
    'raciocinio':'Apresente o racioc√≠nio em passos: fatos ‚Üí norma ‚Üí subsun√ß√£o ‚Üí conclus√£o, usando if/then.',
    'quadro-comp':'Monte uma tabela simples (texto) comparando crit√©rios-chave entre alternativas.',
    'debates':'Aponte controv√©rsias, cr√≠ticas e tend√™ncias; indique pr√≥s/cons de cada posi√ß√£o.',
    'atualiz':'Liste altera√ß√µes legislativas e julgados relevantes nos √∫ltimos 12‚Äì24 meses.',
    'erros':'Liste armadilhas comuns e como evit√°-las, de forma objetiva.',
    'modelo':'Entregue um esqueleto de pe√ßa com cabe√ßalho, fatos, fundamentos, pedidos e fechamento; inclua frases-modelo.',
    'check-peca':'Fa√ßa um checklist passo a passo para valida√ß√£o antes de protocolar.',
    'casos':'Crie 2‚Äì3 cen√°rios pr√°ticos curtos mostrando a aplica√ß√£o do tema.',
    'mapa':'Produza um mapa mental textual com bullets hier√°rquicos.',
    'flash':'Crie 8‚Äì12 flashcards (pergunta ‚Üí resposta curta).',
    'questoes':'Redija 5‚Äì10 quest√µes objetivas/discursivas e traga o gabarito ao final.',
    'check-final':'Checklist conciso de revis√£o para provas.',
    'dicas':'D√™ estrat√©gias de prova, pegadinhas t√≠picas e gest√£o de tempo.',
    'bibliog':'Liste refer√™ncias essenciais (livros/artigos) com breve coment√°rio de utilidade.',
  };

  const BASE_PROMPT = `Voc√™ deve assumir a persona de um **professor especialista em todas as √°reas do Direito brasileiro**, com did√°tica impec√°vel, convidado pelo **direito.love** para auxiliar um estudante de Direito.

üìå Tema escolhido: [INSERIR TEMA AQUI]
üìå Sequ√™ncia de sess√µes: [INSERIR AQUI A SEQU√äNCIA DE SESS√ïES DEFINIDA PELO USU√ÅRIO]

---
### Regras obrigat√≥rias de escrita:
1) Siga exatamente a sequ√™ncia das sess√µes pedidas; nenhuma pode ser omitida.
2) Formata√ß√£o: t√≠tulos claros, bullets quando couber, par√°grafos curtos. Quadros comparativos em tabela textual simples.
3) Em quest√µes: numere (1, 2, 3‚Ä¶), alternativas (A‚ÄìE) e inclua gabarito comentado no final.
4) Evite transcri√ß√µes longas; foque em s√≠ntese com alta aplicabilidade pr√°tica.
5) Linguagem clara e t√©cnica quando necess√°rio.

No final, assine com: üíö direito.love`;

  /* ===== Render categorias ===== */
  const categoriasEl = $("#categorias");
  const selected = new Set();

  function renderCategorias(){
    categoriasEl.innerHTML='';
    for(const cat of CATS){
      const det=document.createElement('details'); det.className='cat'; det.dataset.cat=cat.id;
      const sum=document.createElement('summary');
      const title=document.createElement('span'); title.textContent=cat.label;
      const count=document.createElement('span'); count.className='cat-count'; count.textContent=cat.items.length;
      sum.appendChild(title); sum.appendChild(count);
      det.appendChild(sum);

      const body=document.createElement('div'); body.className='cat-body';

      for(const it of cat.items){
        const card=document.createElement('div'); card.className='option-card'; card.dataset.id=it.id;

        const h=document.createElement('p'); h.className='opt-title'; h.textContent=it.label;
        const d=document.createElement('p'); d.className='opt-desc'; d.textContent=it.desc;
        const actions=document.createElement('div'); actions.className='opt-actions';

        const btnSel=document.createElement('button'); btnSel.className='btn-alt btn-select'; btnSel.textContent='Selecionar';
        const sync=()=>{ const on=selected.has(it.id); btnSel.textContent=on?'Selecionado':'Selecionar'; btnSel.classList.toggle('is-selected',on); updateBar(); };
        btnSel.addEventListener('click',()=>{ if(selected.has(it.id)) selected.delete(it.id); else selected.add(it.id); sync(); });
        sync();

        actions.appendChild(btnSel);
        card.appendChild(h); card.appendChild(d); card.appendChild(actions);
        body.appendChild(card);
      }

      det.appendChild(body);
      categoriasEl.appendChild(det);
    }
  }

  /* ===== Build Prompt ===== */
  const temaEl=$("#tema"), saida=$("#saida"), preview=$("#preview");
  function buildPrompt(){
    const tema=(temaEl.value||'').trim();
    if(!tema){ return ''; }
    if(!selected.size){ return ''; }

    const order=[]; for(const cat of CATS) for(const it of cat.items) if(selected.has(it.id)) order.push(it);
    const seq=order.map(it=>it.label).join(' ‚Üí ');
    const header=BASE_PROMPT.replace('[INSERIR TEMA AQUI]', tema).replace('[INSERIR AQUI A SEQU√äNCIA DE SESS√ïES DEFINIDA PELO USU√ÅRIO]', seq);

    const lines=[header,'','---','### Se√ß√µes com diretrizes detalhadas'];
    for(const it of order){
      lines.push(`\n## ${it.label}`);
      if(it.desc) lines.push(`Descri√ß√£o: ${it.desc}`);
      if(DIRECTIVES[it.id]) lines.push(`Instru√ß√µes para a IA: ${DIRECTIVES[it.id]}`);
    }
    return lines.join('\n');
  }

  /* ===== Barra fixa ===== */
  const bar=$("#ix-bar"), btnPrimary=$("#ix-primary"), btnSecondary=$("#ix-secondary");
  const btnSet=$("#ix-buttons"), chipsTray=$("#ix-chips");
  let hasPrompt=false; // vira true ap√≥s gerar

  function ready(){ return (temaEl.value||'').trim().length>0 && selected.size>0; }
  function updateBar(){
    const show = ready() || hasPrompt; // manter vis√≠vel ap√≥s gerar
    bar.setAttribute('aria-hidden', show ? 'false' : 'true');
    bar.style.display = show ? 'flex' : 'none';

    if(!hasPrompt){
      btnSet.style.display='flex';
      chipsTray.style.display='none';
      btnPrimary.textContent='Gerar Prompt';
      btnPrimary.classList.remove('success');
      btnSecondary.textContent='Limpar';
    }else{
      btnSet.style.display='flex';
      chipsTray.style.display='none';
      btnPrimary.textContent='Copiar Prompt';
      btnPrimary.classList.add('success'); // verde
      btnSecondary.textContent='Novo';
    }
  }

  // Copiar ‚Üí mostra chips de IA
  function showIAChips(){
    btnSet.style.display='none';
    chipsTray.innerHTML='';
    const promptText = (saida.value||'').trim();

    const IAs = [
      { id:'chatgpt', label:'ChatGPT', app:'chatgpt://', web:'https://chatgpt.com/' },
      { id:'claude', label:'Claude', web:'https://claude.ai/new' },
      { id:'perplexity', label:'Perplexity', webQ:(q)=>`https://www.perplexity.ai/search?q=${encodeURIComponent(q)}` },
      { id:'gemini', label:'Gemini', web:'https://gemini.google.com/app' },
      { id:'copilot', label:'Copilot', webQ:(q)=>`https://copilot.microsoft.com/?q=${encodeURIComponent(q)}` },
      { id:'poe', label:'Poe', web:'https://poe.com/' },
    ];

    function smartOpen(item){
      const url = item.webQ ? item.webQ(promptText) : item.web;
      // tenta app (quando houver), com fallback para web
      if(item.app){
        const a=document.createElement('a');
        a.href=item.app; a.style.display='none';
        document.body.appendChild(a);
        let fallback=setTimeout(()=>{ window.open(url,'_blank','noopener'); }, 700);
        a.click();
        setTimeout(()=>{ try{ document.body.removeChild(a);}catch{} },2000);
      }else{
        window.open(url,'_blank','noopener');
      }
    }

    for(const ia of IAs){
      const chip=document.createElement('button');
      chip.type='button'; chip.className='ia-chip';
      chip.textContent=ia.label;
      chip.addEventListener('click',()=>smartOpen(ia));
      chipsTray.appendChild(chip);
    }

    // bot√£o fechar
    const close=document.createElement('button');
    close.type='button'; close.className='ia-close';
    close.textContent='Fechar';
    close.addEventListener('click', ()=>{ resetAll(); window.scrollTo({top:0,behavior:'smooth'}); });
    chipsTray.appendChild(close);

    chipsTray.style.display='flex';
  }

  btnPrimary.addEventListener('click', async ()=>{
    if(!hasPrompt){
      if(!ready()) return;
      const txt=buildPrompt(); if(!txt) return;
      saida.value=txt; preview.style.display='block'; hasPrompt=true; updateBar();
      preview.scrollIntoView({behavior:'smooth', block:'start'});
    }else{
      try{ await navigator.clipboard.writeText(saida.value||''); toast('Copiado!'); }catch{ toast('Copiar falhou'); }
      showIAChips();
    }
  });

  btnSecondary.addEventListener('click', ()=>{
    if(!hasPrompt){ // Limpar
      resetAll();
      window.scrollTo({top:0,behavior:'smooth'});
    }else{ // Novo
      resetAll();
      temaEl.focus();
    }
  });

  // Tema: aviso com atraso de 3s ap√≥s come√ßar a digitar
  let noticeTimer=null, noticeShown=false;
  temaEl.addEventListener('input', ()=>{
    const val=(temaEl.value||'').trim();
    if(val.length===0){
      if(noticeTimer){ clearTimeout(noticeTimer); noticeTimer=null; }
      showNotice(false); noticeShown=false;
      updateBar();
      return;
    }
    // s√≥ agenda quando ainda n√£o mostramos
    if(!noticeShown && !noticeTimer){
      noticeTimer=setTimeout(()=>{ showNotice(true); noticeShown=true; noticeTimer=null; }, 3000);
    }
    updateBar();
  });

  // Importar direto da pesquisa (#pesquisa) ‚Äî cola no tema e mostra aviso imediatamente
  (function importFromPesquisa(){
    const KEY='dl_pesquisa_selecionados';
    try{
      const arr=JSON.parse(localStorage.getItem(KEY)||'[]');
      if((location.hash==='#pesquisa'||arr.length) && arr.length){
        const full=arr.map(i=> i.texto ? String(i.texto).trim() : [i.title||'', i.url||''].filter(Boolean).join(' ‚Äî '))
                      .filter(Boolean).join('\n\n');
        if(full.trim()){
          temaEl.value=full.replace(/\s+\n\s+/g,'\n').trim();
          // Mostra sem delay quando vem da pesquisa
          if(noticeTimer){ clearTimeout(noticeTimer); noticeTimer=null; }
          showNotice(true); noticeShown=true;
          updateBar(); // aparece quando tamb√©m tiver sele√ß√£o
        }
        localStorage.removeItem(KEY);
      }
    }catch(e){}
  })();

  function resetAll(){
    // limpa tudo
    temaEl.value='';
    if(noticeTimer){ clearTimeout(noticeTimer); noticeTimer=null; }
    showNotice(false); noticeShown=false;

    saida.value=''; $("#preview").style.display='none'; hasPrompt=false;

    // limpa sele√ß√µes
    selected.clear();
    $$('.btn-select.is-selected').forEach(b=>b.classList.remove('is-selected'));
    $$('.btn-select').forEach(b=>b.textContent='Selecionar');

    // barra volta ao normal
    $("#ix-buttons").style.display='flex';
    $("#ix-chips").style.display='none';
    updateBar();
  }

  /* Boot */
  renderCategorias();
  updateBar();
})();
</script>
</body>
</html>
