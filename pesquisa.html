<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love — Pesquisa</title>
  <meta name="theme-color" content="#F5C400" />

  <!-- SEO -->
  <meta name="description" content="Pesquisa de artigos, súmulas, jurisprudências e enunciados jurídicos no direito.love" />
  <meta name="keywords" content="pesquisa jurídica, direito, OAB, concursos, jurisprudência, súmulas" />
  <meta name="author" content="direito.love" />
  <meta name="robots" content="index, follow" />

  <!-- Favicon -->
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />

  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:10px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;

      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --bar-h: 64px;

      --success:#16a34a;   /* verde sucesso (Selecionado) */
      --muted-btn:#e5e7eb; /* cinza do botão Limpar */
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:400 13px/1.4 var(--font);}

    /* ===== TOPBAR (igual ao index) ===== */
    .topbar{
      position:sticky; top:0; z-index:100;
      background:var(--highlight);
      border-bottom:1px solid rgba(0,0,0,.08);
      transition: box-shadow .18s ease, padding .18s ease;
    }
    .topbar.is-scrolled{ box-shadow:0 6px 18px rgba(0,0,0,.08); }
    .topbar__inner{
      max-width:1160px; margin:0 auto;
      padding:10px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .topbar.is-scrolled .topbar__inner{ padding:8px 16px; }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; color:#111; }
    .brand__logo{ height:26px; width:auto; display:block; }
    .brand__name{ font:700 18px/1 var(--font); letter-spacing:.2px; }
    .topbar__actions{ display:flex; align-items:center; gap:8px; }
    .icon-btn{
      display:inline-grid; place-items:center;
      width:36px; height:36px; border-radius:10px;
      background:rgba(255,255,255,.85);
      border:1px solid rgba(0,0,0,.06);
      box-shadow:0 1px 0 rgba(255,255,255,.6) inset;
      transition: transform .12s ease, background .15s ease;
    }
    .icon-btn:hover{ transform:translateY(-1px); background:#fff; }
    .icon-btn img{ width:20px; height:20px; display:block; }
    .pill-btn{
      appearance:none; border:1px solid rgba(0,0,0,.1);
      background:#fff; color:#111; padding:8px 12px; border-radius:999px; cursor:pointer;
      font:600 13px/1 var(--font);
      transition: background .15s ease, transform .12s ease;
    }
    .pill-btn:hover{ background:#f6f6f6; transform:translateY(-1px); }
    .pill-btn.hidden{ display:none; }
    @media (max-width:640px){
      .brand__name{ font-size:16px; }
      .topbar__inner{ padding:8px 12px; }
    }

    /* ===== PÁGINA ===== */
    .wrap{max-width:900px;margin:0 auto;padding:22px; transition:padding-bottom .2s ease;}
    h2{margin:0 0 10px;color:var(--primary)}
    .search-box{margin:20px 0}
    #busca{width:100%;padding:10px 12px;border:2px solid var(--primary);border-radius:8px;font-size:15px}

    .result{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:12px 14px;margin:12px 0;position:relative}
    .result p{margin:0;font-size:13px;line-height:1.4}
    .filetag{margin:0 0 6px 0;font-weight:700} /* mesma fonte/tamanho do texto, só bold */
    .pick{display:flex;align-items:center;gap:6px;margin-bottom:8px;font-weight:500}
    .pick input{width:16px;height:16px;cursor:pointer}

    .actions{margin-top:8px;display:flex;justify-content:space-between;gap:8px}
    .btn{appearance:none;border:none;background:var(--highlight);color:#000;padding:6px 10px;border-radius:8px;
      font-size:13px;cursor:pointer;transition:.15s}
    .btn:hover{background:var(--highlight-light)}
    .btn-alt{appearance:none;border:none;background:var(--primary);color:#fff;padding:6px 10px;border-radius:8px;
      font-size:13px;cursor:pointer;transition:.15s}
    .btn-alt:hover{background:#264399}
    /* quando selecionado: verde */
    .btn-alt.is-selected{ background: var(--success); color:#fff; }
    .btn-alt.is-selected:hover{ filter:brightness(.95); }

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;
      padding:8px 12px;border-radius:999px;opacity:0;transition:.2s;z-index:60}
    .toast.show{opacity:1}

    /* Barra flutuante de seleção — minimalista pra não atrapalhar */
    #dl-bar-selecao{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(12px + var(--safe-bottom)); z-index:9999; background:#111; color:#fff;
      padding:10px 12px; border-radius:12px; display:none; align-items:center; gap:8px;
      box-shadow:0 6px 20px rgba(0,0,0,.25); font: 500 14px/1.2 var(--font);
      pointer-events:none; /* não intercepta cliques fora dos botões */
    }
    #dl-bar-selecao button{
      border:0; padding:8px 12px; border-radius:10px; cursor:pointer; pointer-events:auto;
    }
    /* cores diferentes na barra */
    #dl-bar-selecao #dl-enviar{ background: var(--primary); color:#fff; }
    #dl-bar-selecao #dl-enviar:hover{ background:#264399; }
    #dl-bar-selecao #dl-enviar:disabled{ opacity:.5; filter:grayscale(.3); }
    #dl-bar-selecao #dl-limpar{ background: var(--muted-btn); color:#111; }
    #dl-bar-selecao #dl-limpar:hover{ background:#d6dae1; }

    /* Mobile */
    @media (max-width: 480px){
      .btn,.btn-alt{ padding:8px 12px; }
      .pick{ gap:10px; }
    }
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <a class="brand" href="index.html" aria-label="Início">
        <img class="brand__logo" src="icons/logo.png" alt="direito.love" />
      </a>
      <nav class="topbar__actions" aria-label="Ações">
        <a class="icon-btn" href="index.html" aria-label="Início" title="Início">
          <img src="icons/inicio.png" alt="">
        </a>
        <a class="icon-btn" href="pesquisa.html" aria-label="Pesquisar" title="Pesquisar">
          <img src="icons/pesquisar.png" alt="">
        </a>
        <button id="btn-install" class="pill-btn hidden" aria-label="Instalar app">Instalar app</button>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <h2>Pesquisa de Conteúdo Jurídico</h2>
    <p>Digite um termo (artigo, súmula, jurisprudência ou palavra-chave) para buscar nos arquivos.</p>
    <div class="search-box">
      <input id="busca" type="text" placeholder="Ex: artigo 5º, súmula 381, dano moral..." />
    </div>
    <div id="resultados"></div>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>

  <!-- Barra flutuante: só 2 botões -->
  <div id="dl-bar-selecao" aria-live="polite">
    <button id="dl-enviar" disabled>Enviar</button>
    <button id="dl-limpar">Limpar</button>
  </div>

<script>
/* ===== topbar.js (sombra no scroll + PWA install) ===== */
(function(){
  const header = document.querySelector('.topbar');
  const installBtn = document.getElementById('btn-install');
  let deferredPrompt = null;

  const onScroll = () => {
    if (window.scrollY > 2) header.classList.add('is-scrolled');
    else header.classList.remove('is-scrolled');
  };
  window.addEventListener('scroll', onScroll, { passive:true });
  onScroll();

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); deferredPrompt = e;
    installBtn?.classList.remove('hidden');
  });
  installBtn?.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    try{ await deferredPrompt.userChoice; }catch{}
    deferredPrompt = null; installBtn.classList.add('hidden');
  });
})();
</script>

<script>
/* ===== pesquisa.js ===== */
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const resultados=$("#resultados");
  const busca=$("#busca");
  const wrap=$(".wrap");
  const toast=(msg,t=1600)=>{const el=$("#toast");el.textContent=msg;el.classList.add("show");
    setTimeout(()=>el.classList.remove("show"),t);};

  // Config
  const KEY='dl_pesquisa_selecionados';
  const arquivos = [
    "data/penal.json",
    "data/processo_penal.json",
    "data/sumula_stf.json",
    "data/sumulas_vinculantes_stf.json"
  ];
  const MAX_SNIPPET = 400;

  const getCarrinho = ()=>JSON.parse(localStorage.getItem(KEY)||'[]');
  const setCarrinho = (arr)=>localStorage.setItem(KEY, JSON.stringify(arr));
  const dedupPush = (arr, item)=>{
    const k = item.id || item._id || (item.fonte+':'+(item.texto||'').slice(0,50));
    if(!arr.some(x => x.id === k)){
      arr.push({...item, id: k});
    }
    return arr;
  };

  // Carregar dados com "fonte" (nome do arquivo sem .json)
  async function carregarDados(){
    const dados=[];
    for(const arq of arquivos){
      try{
        const tag = arq.split('/').pop().replace(/\.json$/,''); // ex: cpp
        const r=await fetch(arq); if(!r.ok) continue;
        const j=await r.json();
        (Array.isArray(j)? j : []).forEach((it, idx)=>{
          const _id = it.id || `${tag}_${idx}`;
          dados.push({ ...it, _id, fonte: tag });
        });
      }catch(e){ console.warn("Erro ao carregar",arq,e); }
    }
    return dados;
  }

  let baseDados=[];
  carregarDados().then(d=>{
    baseDados=d;
    toast("Base carregada com sucesso!");
    if(busca.value.trim()) filtrarRender();
  });

  // Render
  function renderizarResultados(lista){
    resultados.innerHTML="";
    if(!lista.length){
      resultados.innerHTML="<p>Nenhum resultado encontrado.</p>";
      toggleBar(false);
      return;
    }
    toggleBar(true);

    const carrinho = getCarrinho();

    lista.forEach(item=>{
      const div=document.createElement("div");
      div.className="result";

      // checkbox seleção (topo)
      const pick=document.createElement('label');
      pick.className='pick';
      const chk=document.createElement('input');
      chk.type='checkbox';
      chk.checked = carrinho.some(x => x.id === (item.id||item._id));
      pick.appendChild(chk);
      pick.appendChild(document.createTextNode('Selecionar'));
      div.appendChild(pick);

      // linha com fonte em negrito (mesmo tamanho do texto)
      const fonteP = document.createElement('p');
      fonteP.className = 'filetag';
      fonteP.innerHTML = `<strong>${(item.fonte||'').trim()}</strong>`;
      div.appendChild(fonteP);

      // texto (snippet)
      const p=document.createElement("p");
      const txt = (item.texto||'').trim();
      p.textContent = txt.length>MAX_SNIPPET ? (txt.substring(0,MAX_SNIPPET)+"...") : txt;
      div.appendChild(p);

      // ações
      const actions=document.createElement("div");
      actions.className="actions";

      // Copiar
      const copiar=document.createElement("button");
      copiar.textContent="Copiar";
      copiar.className="btn";
      copiar.addEventListener("click",async()=>{
        try{
          await navigator.clipboard.writeText(item.texto||'');
          toast("Copiado!");
        }catch{ toast("Erro ao copiar."); }
      });

      // Selecionar (botão que acompanha o estado do checkbox)
      const selBtn=document.createElement("button");
      selBtn.className="btn-alt";
      const setSelLabel = ()=>{
        selBtn.textContent = chk.checked ? "Selecionado" : "Selecionar";
        selBtn.classList.toggle('is-selected', chk.checked); // muda cor quando selecionado
      };
      setSelLabel();
      selBtn.addEventListener("click",()=>{
        chk.checked = !chk.checked;
        chk.dispatchEvent(new Event('change'));
      });

      actions.appendChild(copiar);
      actions.appendChild(selBtn);
      div.appendChild(actions);

      // lógica do checkbox
      chk.addEventListener('change',()=>{
        let arr=getCarrinho();
        const obj = { id: item.id||item._id, fonte:item.fonte, texto:item.texto };
        if(chk.checked){
          arr = dedupPush(arr, obj);
        }else{
          arr = arr.filter(x => x.id !== obj.id);
        }
        setCarrinho(arr);
        setSelLabel();
        updateBar();
      });

      resultados.appendChild(div);
    });

    updateBar();
  }

  function updateBar(){
    const c=getCarrinho().length;
    $('#dl-enviar').disabled = c===0;
  }

  function toggleBar(show){
    const bar = $('#dl-bar-selecao');
    bar.style.display = show ? 'flex' : 'none';
    // evita que a barra cubra o último item
    document.querySelector('.wrap').style.paddingBottom = show ? `calc(var(--bar-h) + 16px + var(--safe-bottom))` : '22px';
  }

  // barra: enviar / limpar
  $('#dl-enviar').addEventListener('click', ()=> {
    window.location.href = 'index.html#pesquisa';
  });
  $('#dl-limpar').addEventListener('click', ()=> {
    localStorage.removeItem(KEY);
    updateBar();
    $$('.pick input', resultados).forEach(i=>{ i.checked=false; });
  });

  function filtrarRender(){
    const termo=busca.value.toLowerCase().trim();
    if(!termo){resultados.innerHTML=""; toggleBar(false); return;}
    const achados=baseDados.filter(x=>
      (x.texto||'').toLowerCase().includes(termo)
    );
    renderizarResultados(achados);
  }

  busca.addEventListener("input",filtrarRender);
})();
</script>
</body>
</html>
