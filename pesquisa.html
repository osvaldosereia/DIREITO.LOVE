<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love — Pesquisa</title>
  <meta name="theme-color" content="#F5C400" />
  <meta name="description" content="Pesquisa de artigos, súmulas, jurisprudências e logo jurídicos no direito.love" />
  <meta name="keywords" content="pesquisa jurídica, direito, OAB, concursos, jurisprudência, súmulas" />
  <meta name="author" content="direito.love" />
  <meta name="robots" content="index, follow" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />

  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:10px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --bar-h: 64px;
      --success:#16a34a;
      --muted-btn:#e5e7eb;
      --news-btn:#0077cc;
      --news-btn-hover:#3399ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:400 13px/1.4 var(--font);}
    .topbar{position:sticky; top:0; z-index:100; background:var(--highlight); border-bottom:1px solid rgba(0,0,0,.08)}
    .topbar__inner{max-width:1160px; margin:0 auto; padding:10px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#111}
    .brand__logo{height:36px; width:auto; display:block}
    .chip{padding:6px 14px; border-radius:20px; background:#fff; border:1px solid var(--border); font-size:13px; color:var(--primary); text-decoration:none; font-weight:500; transition:.15s}
    .chip:hover{background:var(--highlight-light)}
    .wrap{max-width:900px;margin:0 auto;padding:22px; transition:padding-bottom .2s ease;}
    h2{margin:0 0 10px;color:var(--primary)}
    .search-box{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:20px 0;}
    #busca{flex:1; padding:10px 12px; border:2px solid var(--primary); border-radius:8px; font-size:15px}
    #filtroFonte{padding:10px; border:2px solid var(--primary); border-radius:8px; font-size:14px}
    #btnBuscar{appearance:none; border:none; background:var(--primary); color:#fff; padding:10px 14px; border-radius:8px; font-size:14px; cursor:pointer;}
    #btnBuscar:disabled{opacity:.7; cursor:progress}
    .mini-relatorio{position:sticky; top:50px; background:#fff7d6; padding:8px 16px; display:none; gap:8px; flex-wrap:wrap; border-bottom:1px solid var(--border); z-index:90}
    .mini-relatorio .chip{background:#fff; border:1px solid var(--border);}
    .result{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:12px 14px;margin:12px 0;position:relative}
    .result p{margin:0;font-size:13px;line-height:1.4}
    .filetag{margin:0 0 6px 0;font-weight:700}
    .actions{margin-top:8px;display:flex;gap:8px;align-items:center}
    .btn{appearance:none;border:none;background:var(--highlight);color:#000;padding:6px 10px;border-radius:8px;
      font-size:13px;cursor:pointer;transition:.15s}
    .btn:hover{background:var(--highlight-light)}
    .btn-alt{appearance:none;border:none;background:var(--primary);color:#fff;padding:6px 10px;border-radius:8px;
      font-size:13px;cursor:pointer;transition:.15s}
    .btn-alt:hover{background:#264399}
    .btn-alt.is-selected{ background: var(--success); color:#fff; }
    .btn-alt.is-selected:hover{ filter:brightness(.95); }
    .btn-news{background:var(--news-btn);color:#fff;text-decoration:none;display:inline-block;padding:6px 10px;border-radius:8px;font-size:13px;margin-left:auto}
    .btn-news:hover{background:var(--news-btn-hover)}
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <a class="brand" href="index.html" aria-label="Início">
        <img class="brand__logo" src="icons/logo.png" alt="direito.love" />
      </a>
      <nav class="topbar__actions" aria-label="Ações">
        <a class="chip" href="index.html">Prompt</a>
        <a class="chip" href="pesquisa.html">Pesquisar</a>
      </nav>
    </div>
  </header>

  <div id="miniRelatorio" class="mini-relatorio"></div>

  <div class="wrap">
    <h2>Pesquisa de Conteúdo Jurídico</h2>
    <p>Digite um termo (artigo, súmula, jurisprudência ou palavra-chave) e clique em <b>Buscar</b>.</p>
    <div class="search-box">
      <select id="filtroFonte">
        <option value="todas">Todas as fontes</option>
        <option value="noticias_migalhas">Notícias Migalhas</option>
        <option value="sumula_stf">Súmulas STF</option>
        <option value="penal">Código Penal</option>
      </select>
      <input id="busca" type="text" placeholder="Ex: artigo 5º, súmula 381, dano moral..." />
      <button id="btnBuscar">Buscar</button>
    </div>
    <div id="resultados"></div>
    <div class="more-wrap" style="display:none"><button id="btnMais" class="btn">Carregar mais</button></div>
  </div>

<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const resultados=$("#resultados");
  const busca=$("#busca");
  const btnBuscar=$("#btnBuscar");
  const filtroFonte=$("#filtroFonte");
  const miniRelatorio=$("#miniRelatorio");
  let baseDados=[];let lastResults=[];let pageIndex=0;

  // nomes bonitos
  const nomesAmigaveis={
    "noticias_migalhas_1":"Notícias Migalhas",
    "noticias_migalhas_2":"Notícias Migalhas",
    "noticias_migalhas_3":"Notícias Migalhas",
    "sumula_stf":"Súmulas STF",
    "penal":"Código Penal"
  };

  async function carregarDados(){
    const arquivos=[
      "data/noticias_migalhas_1.json",
      "data/noticias_migalhas_2.json",
      "data/noticias_migalhas_3.json",
      "data/sumula_stf.json",
      "data/penal.json"
    ];
    const dados=[];
    for(const arq of arquivos){
      try{
        const tag=arq.split('/').pop().replace(/\.json$/,'');
        const r=await fetch(arq); if(!r.ok) continue;
        const j=await r.json();
        (Array.isArray(j)?j:[]).forEach((it, idx)=>{
          const _id=it.id||`${tag}_${idx}`;
          dados.push({...it,_id,fonte:tag,textoNorm:(it.texto||"").toLowerCase()});
        });
      }catch(e){console.warn("Erro ao carregar",arq,e);}
    }
    baseDados=dados;
  }

  function renderMiniRelatorio(results){
    const contagem=results.reduce((acc,it)=>{
      acc[it.fonte]=(acc[it.fonte]||0)+1;
      return acc;
    },{});
    miniRelatorio.innerHTML="";
    Object.keys(contagem).forEach(f=>{
      const chip=document.createElement("a");
      chip.className="chip";
      chip.textContent=`${nomesAmigaveis[f]||f}: ${contagem[f]}`;
      chip.href="#";
      chip.addEventListener("click",(e)=>{
        e.preventDefault();
        const alvo=$(`[data-fonte="${f}"]`);
        if(alvo) alvo.scrollIntoView({behavior:"smooth"});
      });
      miniRelatorio.appendChild(chip);
    });
    miniRelatorio.style.display="flex";
  }

  function renderResults(results){
    resultados.innerHTML="";
    results.forEach(item=>{
      const div=document.createElement("div");
      div.className="result";
      div.setAttribute("data-fonte",item.fonte);

      const fonteP=document.createElement("p");
      fonteP.className="filetag";
      fonteP.innerHTML=`<strong>${nomesAmigaveis[item.fonte]||item.fonte}</strong>`;
      div.appendChild(fonteP);

      const p=document.createElement("p");
      p.textContent=item.texto||"";
      div.appendChild(p);

      const actions=document.createElement("div");
      actions.className="actions";

      if(item.url){
        const ver=document.createElement("a");
        ver.textContent="Ver notícia";
        ver.href=item.url;
        ver.target="_blank";
        ver.className="btn-news";
        actions.appendChild(ver);
      }
      div.appendChild(actions);
      resultados.appendChild(div);
    });
  }

  async function executarBusca(){
    const termo=busca.value.toLowerCase();
    const filtro=filtroFonte.value;
    lastResults=baseDados.filter(x=>{
      const fonteOk=(filtro==="todas"||x.fonte.includes(filtro));
      return fonteOk && x.textoNorm.includes(termo);
    });
    if(!lastResults.length){
      resultados.innerHTML="<p>Nenhum resultado encontrado.</p>";
      miniRelatorio.style.display="none";
      return;
    }
    renderMiniRelatorio(lastResults);
    renderResults(lastResults);
  }

  btnBuscar.addEventListener("click",executarBusca);
  busca.addEventListener("keydown",e=>{if(e.key==="Enter"){executarBusca();}});
  carregarDados();
})();
</script>
</body>
</html>
