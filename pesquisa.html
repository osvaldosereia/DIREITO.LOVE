<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love — Pesquisa</title>
  <meta name="theme-color" content="#F5C400" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />

  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:10px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;
    }
    body{margin:0;background:var(--bg);color:var(--text);font:400 14px/1.5 var(--font);}

    /* TOPBAR */
    .topbar{background:var(--highlight); border-bottom:1px solid rgba(0,0,0,.1);}
    .topbar__inner{max-width:1160px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;}
    .brand__logo{height:32px;}

    /* HERO */
    .hero{background:var(--highlight);text-align:center;padding:30px 10px;}
    .hero img{max-width:260px;height:auto;}

    /* Página */
    .wrap{max-width:900px;margin:0 auto;padding:22px;}
    h2{margin:0 0 10px;color:var(--primary)}

    .search-box{display:flex;gap:10px;margin:20px 0;}
    #busca{flex:1;padding:10px;border:2px solid var(--primary);border-radius:8px;font-size:15px}
    #btnBuscar{background:var(--primary);color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;}
    #btnBuscar:disabled{opacity:.6;cursor:progress;}

    .result{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:12px;margin:12px 0;}
    .result p{margin:0;font-size:13px;line-height:1.4}
    .filetag{font-weight:700;margin-bottom:6px}

    .actions{margin-top:8px;display:flex;justify-content:space-between;gap:8px}
    .btn{background:var(--highlight);border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:13px;}
    .btn:hover{background:var(--highlight-light);}
    .btn-alt{background:var(--primary);color:#fff;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;font-size:13px;}
    .btn-alt.is-selected{background:#16a34a;}

    .more-wrap{text-align:center;margin:20px 0;}
    #btnMais{padding:10px 20px;border-radius:8px;cursor:pointer;}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;
      padding:8px 12px;border-radius:999px;opacity:0;transition:.2s;z-index:60}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <div class="topbar__inner">
      <a href="index.html"><img class="brand__logo" src="icons/logo.png" alt="direito.love"></a>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <img src="icons/robo.png" alt="Robô direito.love" />
  </section>

  <!-- CONTEÚDO -->
  <div class="wrap">
    <h2>Pesquisa de Conteúdo Jurídico</h2>
    <div class="search-box">
      <input id="busca" type="text" placeholder="Ex: artigo 5º, súmula 381, dano moral..." />
      <button id="btnBuscar">Buscar</button>
    </div>
    <div id="resultados"></div>
    <div class="more-wrap" style="display:none">
      <button id="btnMais" class="btn">Carregar mais</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

<script>
(function(){
  const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
  const busca=$("#busca"), btnBuscar=$("#btnBuscar"), resultados=$("#resultados"), btnMais=$("#btnMais"), toastEl=$("#toast");
  const arquivos=[
    "data/julgados_direito_administrativo.json",
    "data/julgados_direito_ambiental.json",
    "data/julgados_direito_bancario.json",
    "data/penal.json",
    "data/processo_penal.json",
    "data/sumula_stf.json",
    "data/sumulas_stj.json",
    "data/sumulas_tse.json",
    "data/sumulas_vinculantes_stf.json",
    "data/temas_repetitivos_stj.json",
    "data/teses_stf.json"
  ];
  const norm=s=>(s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
  let cache={}, lastResults=[], page=0, PAGE_SIZE=10;

  async function getData(){
    let all=[];
    for(const arq of arquivos){
      if(!cache[arq]){
        try{let r=await fetch(arq); if(r.ok){cache[arq]=(await r.json()).map((it,i)=>({...it,fonte:arq.replace("data/","").replace(".json",""), textoNorm:norm(it.texto)}));}}
        catch(e){console.warn("Erro",arq);}
      }
      all=all.concat(cache[arq]||[]);
    }
    return all;
  }

  function showToast(msg){toastEl.textContent=msg;toastEl.classList.add("show");setTimeout(()=>toastEl.classList.remove("show"),1600);}

  function renderBatch(){
    const start=page*PAGE_SIZE, end=Math.min(lastResults.length,(page+1)*PAGE_SIZE);
    for(let i=start;i<end;i++){
      const item=lastResults[i];
      const div=document.createElement("div"); div.className="result";
      div.innerHTML=`<p class="filetag">${item.fonte}</p><p>${item.texto}</p>
      <div class="actions"><button class="btn">Copiar</button></div>`;
      div.querySelector(".btn").onclick=async()=>{await navigator.clipboard.writeText(item.texto);showToast("Copiado!");};
      resultados.appendChild(div);
    }
    page++;
    btnMais.parentElement.style.display=page*PAGE_SIZE<lastResults.length?"block":"none";
  }

  async function buscar(){
    resultados.innerHTML=""; page=0; lastResults=[];
    const termo=norm(busca.value.trim()); if(!termo) return;
    btnBuscar.disabled=true;
    let data=await getData();
    lastResults=data.filter(x=>x.textoNorm.includes(termo));
    if(!lastResults.length){resultados.innerHTML="<p>Nenhum resultado.</p>"; return;}
    renderBatch();
    btnBuscar.disabled=false;
  }

  btnBuscar.onclick=buscar;
  busca.onkeydown=e=>{if(e.key==="Enter") buscar();};
  btnMais.onclick=()=>renderBatch();
})();
</script>
</body>
</html>
