<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love — Pesquisa</title>
  <meta name="theme-color" content="#F5C400" />
  <meta name="description" content="Pesquisa de artigos, súmulas, jurisprudências e conteúdos jurídicos no direito.love" />
  <meta name="keywords" content="pesquisa jurídica, direito, OAB, concursos, jurisprudência, súmulas" />
  <meta name="author" content="direito.love" />
  <meta name="robots" content="index, follow" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />
  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:12px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --bar-h: 56px;
      --success:#16a34a;
      --muted-btn:#e5e7eb;
      --news-btn:#16a34a;
      --news-btn-hover:#22c55e;
      --snap-offset: 96px;
      --btn-pad-y: 6px;    /* altura menor */
      --btn-pad-x: 10px;   /* largura menor */
      --btn-font: 12.5px;  /* fonte menor */
      --btn-min-h: 34px;   /* antes ~44px */
      --btn-min-w: 96px;   /* antes 110-180px */
      --chip-pad-y: 6px;   /* chips topbar no mesmo padrão */
      --chip-pad-x: 10px;
      --chip-font: 12.5px;
      --chip-radius: 8px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:400 13px/1.4 var(--font);}

    /* Topbar */
    .topbar{position:sticky; top:0; z-index:100; background:var(--highlight); border-bottom:1px solid rgba(0,0,0,.08)}
    .topbar__inner{max-width:1160px; margin:0 auto; padding:8px 12px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#111}
    .brand__logo{height:32px}
    .chip{
      padding:var(--chip-pad-y) var(--chip-pad-x);
      border-radius:var(--chip-radius);
      background:#fff; border:1px solid var(--border);
      font-size:var(--chip-font); color:var(--primary); text-decoration:none; font-weight:600; transition:.15s
    }
    .chip:hover{background:var(--highlight-light)}

    /* Layout */
    .wrap{max-width:900px;margin:0 auto;padding:22px; transition:padding-bottom .2s ease;}
    h2{margin:0 0 10px;color:var(--primary)}
    .search-box{display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:20px 0;}
    #busca{flex:1; padding:10px 12px; border:2px solid var(--primary); border-radius:8px; font-size:15px}
    #btnBuscar{
      appearance:none; border:1px solid var(--primary); background:var(--primary); color:#fff;
      padding:var(--btn-pad-y) var(--btn-pad-x); border-radius:8px; font-size:var(--btn-font); cursor:pointer;
      min-height:var(--btn-min-h); min-width:var(--btn-min-w);
    }
    #btnBuscar:disabled{opacity:.7; cursor:progress}

    /* Acordeões de categorias */
    #categorias{ margin-top: 10px; }
    .cat{
      background:var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow);
      margin:12px 0; overflow:hidden; scroll-margin-top: var(--snap-offset);
    }
    .cat > summary{
      list-style:none; cursor:pointer; padding:10px 14px; font-weight:800; color:var(--primary);
      display:flex; align-items:center; justify-content:space-between;
    }
    .cat > summary::-webkit-details-marker{ display:none; }
    .cat[open] > summary{ background:#fff7d6; }
    .cat-count{ font-weight:700; background:#0f172a0d; color:#0f172a; padding:2px 8px; border-radius:999px; font-size:12px; }

    .cat-body{ padding: 10px 14px; }
    .cat-more{ display:flex; justify-content:center; padding: 4px 14px 12px; }
    .cat-more .btn{ min-width: var(--btn-min-w); }

    /* Card de resultado */
    .result{
      background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);
      padding:12px 14px;margin:10px 0;position:relative;
    }
    .filetag{
      display:inline-block; font-weight:700; font-size:12px; padding:2px 8px; border-radius:999px;
      background:#f1f5f9; color:#0f172a; margin:0 0 8px 0;
    }
    .result p{margin:0;font-size:13px;line-height:1.55}
    .actions{margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    /* Botões menores e padronizados */
    .btn{
      appearance:none;border:1px solid var(--border);background:var(--highlight);color:#000;
      padding:var(--btn-pad-y) var(--btn-pad-x);border-radius:8px;
      font-size:var(--btn-font);cursor:pointer;transition:.15s; min-height:var(--btn-min-h); min-width:var(--btn-min-w);
    }
    .btn:hover{background:var(--highlight-light)}
    .btn-alt{
      appearance:none;border:1px solid #0f2a71;background:var(--primary);color:#fff;
      padding:var(--btn-pad-y) var(--btn-pad-x);border-radius:8px;
      font-size:var(--btn-font);cursor:pointer;transition:.15s; min-height:var(--btn-min-h); min-width:var(--btn-min-w);
    }
    .btn-alt:hover{background:#264399}
    .btn-alt.is-selected{ background: var(--success); color:#fff; border-color:#168a44; }
    .btn-alt.is-selected:hover{ filter:brightness(.95); }
    .btn-news{
      background:var(--news-btn);color:#fff;text-decoration:none;display:inline-block;
      padding:var(--btn-pad-y) var(--btn-pad-x);border-radius:8px;font-size:var(--btn-font);
      min-height:var(--btn-min-h); min-width:var(--btn-min-w); margin-left:auto; border:1px solid #0e8f42;
    }
    .btn-news:hover{background:var(--news-btn-hover)}

    .toggle-more{ margin-left:6px; background:none; border:0; color:var(--primary); cursor:pointer; font-size:12px; padding:2px 4px; line-height:1; }

    /* Barra seleção */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;
      padding:8px 12px;border-radius:999px;opacity:0;transition:.2s;z-index:60}
    .toast.show{opacity:1}
    #dl-bar-selecao{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(10px + var(--safe-bottom)); z-index:9999; background:#111; color:#fff;
      padding:8px 10px; border-radius:12px; display:none; align-items:center; gap:8px;
      box-shadow:0 6px 20px rgba(0,0,0,.25); font: 500 13px/1.2 var(--font);
      pointer-events:none;
    }
    #dl-bar-selecao button{
      border:1px solid var(--border); padding:var(--btn-pad-y) var(--btn-pad-x);
      border-radius:8px; cursor:pointer; pointer-events:auto; font-size:var(--btn-font);
      min-height:var(--btn-min-h); min-width:var(--btn-min-w);
    }
    #dl-enviar{ background: var(--primary); color:#fff; border-color:#0f2a71; } #dl-enviar:hover{ background:#264399; } #dl-enviar:disabled{ opacity:.5; filter:grayscale(.3) }
    #dl-limpar{ background:#fff; color:#111; } #dl-limpar:hover{ background:#f2f4f7 }

    @media (max-width: 600px){
      .actions{ gap:8px; }
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <a class="brand" href="index.html" aria-label="Início">
        <img class="brand__logo" src="icons/logo.png" alt="direito.love" />
      </a>
      <nav class="topbar__actions" aria-label="Ações">
        <a class="chip" href="index.html">Prompt</a>
        <a class="chip" href="pesquisa.html">Pesquisar</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <h2>Pesquisa de Conteúdo Jurídico</h2>
    <p>Digite um termo (artigo, súmula, jurisprudência ou palavra-chave) e clique em <b>Buscar</b>.</p>

    <div class="search-box">
      <input id="busca" type="text" placeholder="Ex: art. 150 CP, súmula 381, dano moral..." />
      <button id="btnBuscar">Buscar</button>
    </div>

    <!-- Contêiner dos acordeões de categorias -->
    <section id="categorias"></section>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>

  <div id="dl-bar-selecao" aria-live="polite">
    <button id="dl-enviar" disabled>Enviar para o Prompt</button>
    <button id="dl-limpar">Limpar</button>
  </div>

<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const categoriasEl=$("#categorias");
  const busca=$("#busca");
  const btnBuscar=$("#btnBuscar");
  const wrap=$(".wrap");
  const toast=(m,t=1600)=>{const el=$("#toast");el.textContent=m;el.classList.add("show");setTimeout(()=>el.classList.remove("show"),t);};

  // -------- Config: abrir primeira categoria automaticamente? --------
  const AUTO_OPEN_FIRST = false; // deixe true se quiser abrir a primeira

  // ---------- Normalização e parsing jurídico ----------
  const norm=(s="")=>s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();
  function normalizeLegal(s){
    let t=norm(s);
    t=t.replace(/§+/g,' paragrafo ');
    t=t.replace(/\bpar\.?\b/g,' paragrafo ');
    t=t.replace(/\bart\.?\b|\bartigo\b/g,' art ');
    t=t.replace(/\binc\.?\b/g,' inciso ');
    t=t.replace(/\bal\.?\b/g,' alinea ');
    t=t.replace(/\bunico\b/g,' unico ');
    t=t.replace(/(\d+)\s*[ºªoa]\b/g,'$1');
    t=t.replace(/["'()]/g,' ').replace(/\s+/g,' ').trim();
    return t;
  }
  const STOP=new Set(['de','da','do','das','dos','e','ou','a','o','as','os','no','na','nos','nas','para','por','em','um','uma','ao','à','que','com','sem','sobre','entre','ate']);
  const esc=(s)=>s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  function hasWhole(hay, word){ if(!word) return true; const re=new RegExp(`(^|[^a-z0-9])${esc(word)}([^a-z0-9]|$)`,'i'); return re.test(hay); }
  function hasAllWords(hay, words){ for(const w of words){ if(!hasWhole(hay,w)) return false; } return true; }
  const romanLower=(s='')=>String(s).replace(/[^ivxlcdm]/gi,'').toLowerCase();

  function parseLegalQuery(raw){
    const base = normalizeLegal(raw);
    const padded = ` ${base} `;
    const alias=[
      {re:/\b(cp|codigo penal)\b/, tag:'cp'},
      {re:/\b(cpp|codigo de processo penal)\b/, tag:'cpp'},
      {re:/\b(cc|codigo civil)\b/, tag:'cc'},
      {re:/\b(cpc|codigo de processo civil)\b/, tag:'cpc'},
      {re:/\b(ctn|codigo tributario nacional)\b/, tag:'ctn'},
      {re:/\b(cdc|codigo de defesa do consumidor)\b/, tag:'cdc'},
      {re:/\b(ctb|codigo de transito brasileiro)\b/, tag:'ctb'}
    ];
    let tokens = base.split(' ').filter(Boolean).filter(t=>!STOP.has(t));
    let artNum=null; { const m=padded.match(/\bart\s*([0-9][0-9a-z\-]*)\b/); if(m) artNum=m[1]; }
    let paragrafo=null; { const m=padded.match(/\bparagrafo\s*(unico|\d+)\b/); if(m) paragrafo=m[1]; }
    let inciso=null; { const m=padded.match(/\binciso\s*([ivxlcdm]+)\b/); if(m) inciso=romanLower(m[1]); }
    let alinea=null; { const m=padded.match(/\balinea\s*([a-z])\b/); if(m) alinea=m[1].toLowerCase(); }
    const caput = /\bcaput\b/.test(padded);

    const out=new Set(tokens);
    if(artNum){ out.add('art'); out.add(String(artNum)); }
    if(paragrafo){ out.add('paragrafo'); out.add(String(paragrafo)); }
    if(inciso){ out.add('inciso'); out.add(inciso); }
    if(alinea){ out.add('alinea'); out.add(alinea); }
    if(caput){ out.add('caput'); }
    for(const a of alias){ if(a.re.test(padded)) out.add(a.tag); }

    return { words:[...out] };
  }

  // ---------- Fontes, categorias e nomes ----------
  const arquivos = [
    "data/julgados_direito_administrativo.json",
    "data/julgados_direito_ambiental.json",
    "data/julgados_direito_bancario.json",
    "data/julgados_direito_civil.json",
    "data/julgados_direito_constitucional.json",
    "data/julgados_direito_eleitoral.json",
    "data/julgados_direito_empresarial.json",
    "data/noticias_migalhas_1.json",
    "data/noticias_migalhas_2.json",
    "data/noticias_migalhas_3.json",
    "data/codigo_penal.json",
    "data/codigo_processo_penal.json",
    "data/sumula_stf.json",
    "data/sumulas_stj.json",
    "data/sumulas_tse.json",
    "data/sumulas_vinculantes_stf.json",
    "data/temas_repetitivos_stj.json",
    "data/teses_stf.json",
    "data/codigo_processo_civil.json",
    "data/codigo_civil.json",
    "data/codigo_tributario_nacional.json",
    "data/codigo_defesa_consumidor.json",
    "data/codigo_transito_brasileiro.json"
  ];

  const nomesAmigaveis = {
    noticias: "Notícias",
    noticias_migalhas_1: "Notícias Migalhas",
    noticias_migalhas_2: "Notícias Migalhas",
    noticias_migalhas_3: "Notícias Migalhas",
    sumula_stf: "Súmulas STF",
    sumulas_stj: "Súmulas STJ",
    sumulas_tse: "Súmulas TSE",
    sumulas_vinculantes_stf: "Súmulas Vinculantes STF",
    temas_repetitivos_stj: "Temas Repetitivos STJ",
    teses_stf: "Teses STF",
    codigo_tributario_nacional: "Código Tributário Nacional",
    codigo_penal: "Código Penal",
    codigo_civil: "Código Civil",
    codigo_processo_penal: "Código de Processo Penal",
    codigo_processo_civil: "Código de Processo Civil",
    julgados_direito_administrativo: "Julgados de Direito Administrativo",
    julgados_direito_ambiental: "Julgados de Direito Ambiental",
    julgados_direito_bancario: "Julgados de Direito Bancário",
    julgados_direito_civil: "Julgados de Direito Civil",
    julgados_direito_constitucional: "Julgados de Direito Constitucional",
    julgados_direito_eleitoral: "Julgados de Direito Eleitoral",
    julgados_direito_empresarial: "Julgados de Direito Empresarial",
    codigo_defesa_consumidor: "Código de Defesa do Consumidor",
    codigo_transito_brasileiro: "Código de Trânsito Brasileiro"
  };

  const catOrder = ["noticias", "codigos", "sumulas", "julgados", "temas_repetitivos_stj", "teses_stf", "outros"];
  const categorias = {
    noticias: { label: "Notícias", match: f => f.startsWith("noticias") },
    codigos: { label: "Códigos", match: f => f.startsWith("codigo_") },
    sumulas: { label: "Súmulas", match: f => f.startsWith("sumula") || f.startsWith("sumulas_") || f==="sumulas_vinculantes_stf" },
    julgados: { label: "Julgados", match: f => f.startsWith("julgados_") },
    temas_repetitivos_stj: { label: "Temas Repetitivos STJ", match: f => f==="temas_repetitivos_stj" },
    teses_stf: { label: "Teses STF", match: f => f==="teses_stf" },
    outros: { label: "Outros", match: f => true }
  };

  const normalizarFonte = (f)=> f && f.startsWith('noticias') ? 'noticias' : f;

  // ---------- Carregar base ----------
  const KEY='dl_pesquisa_selecionados';
  const getCarrinho=()=>JSON.parse(localStorage.getItem(KEY)||'[]');
  const setCarrinho=(a)=>localStorage.setItem(KEY, JSON.stringify(a));
  const dedupPush=(arr,item)=>{ const k=item.id||item._id||(item.fonte+':'+(item.texto||'').slice(0,50)); if(!arr.some(x=>x.id===k)) arr.push({...item,id:k}); return arr; };

  async function carregarDados(){
    const dados=[];
    for(const arq of arquivos){
      try{
        const tag=arq.split('/').pop().replace(/\.json$/,'');
        const r=await fetch(arq); if(!r.ok) continue;
        const j=await r.json();
        (Array.isArray(j)?j:[]).forEach((it,idx)=>{
          const _id=it.id||`${tag}_${idx}`;
          const texto=(it.texto||'').trim();
          dados.push({ ...it, _id, fonte:tag, textoNorm: norm(texto), textoLegal: normalizeLegal(texto) });
        });
      }catch(e){ console.warn('Erro ao carregar',arq,e); }
    }
    return dados;
  }

  // ---------- Estado ----------
  const MAX_SNIPPET=400, PAGE_SIZE=10;
  let baseDados=[];

  // ---------- Util: card ----------
  function buildCard(item, carrinho){
    const fNorm = normalizarFonte(item.fonte);
    const isNoticias = fNorm === 'noticias';
    const nomeBonito = nomesAmigaveis[fNorm] || nomesAmigaveis[item.fonte] || item.fonte;

    const div=document.createElement("div");
    div.className="result";

    const fonteP=document.createElement('div');
    fonteP.className='filetag';
    fonteP.textContent = nomeBonito;
    div.appendChild(fonteP);

    const p=document.createElement("p");
    const txt=(item.texto||'').trim();
    const isLong=txt.length>MAX_SNIPPET;
    p.textContent=isLong?txt.substring(0,MAX_SNIPPET)+'…':txt;
    div.appendChild(p);

    if(isLong){
      const tg=document.createElement('button'); tg.type='button'; tg.className='toggle-more';
      tg.textContent='Ver mais'; tg.dataset.expanded='0';
      tg.addEventListener('click',()=>{ const on=tg.dataset.expanded==='1';
        if(on){ p.textContent=txt.substring(0,MAX_SNIPPET)+'…'; tg.textContent='Ver mais'; tg.dataset.expanded='0'; }
        else { p.textContent=txt; tg.textContent='Ver menos'; tg.dataset.expanded='1'; }
      }); p.after(tg);
    }

    const actions=document.createElement("div"); actions.className="actions";

    // Texto para seleção (para notícias, usamos título+url se não houver 'texto')
    const copyText = (item.texto && item.texto.trim())
      ? item.texto
      : [item.titulo || item.title || '', item.url || ''].filter(Boolean).join(' — ');

    // Copiar: APENAS se NÃO for notícia
    if(!isNoticias){
      const copiar=document.createElement("button"); copiar.textContent='Copiar'; copiar.className='btn';
      copiar.addEventListener("click",async()=>{ try{ await navigator.clipboard.writeText(copyText||''); toast('Copiado!'); }catch{ toast('Erro ao copiar.'); } });
      actions.appendChild(copiar);
    }

    // Selecionar: sempre
    const sel=document.createElement("button"); sel.className='btn-alt';
    const key = item.id || item._id || ( (item.fonte||'') + ':' + (copyText||'').slice(0,50) );
    const sync=(on)=>{ sel.textContent=on?'Selecionado':'Selecionar'; sel.classList.toggle('is-selected',on); };
    sync(carrinho.some(x=>x.id===key));
    sel.addEventListener('click',()=>{
      let arr=getCarrinho();
      const obj={ id:key, fonte:item.fonte, texto: copyText };
      if(arr.some(x=>x.id===key)){ arr=arr.filter(x=>x.id!==key); sync(false); }
      else { arr=dedupPush(arr,obj); sync(true); }
      setCarrinho(arr); updateBar();
    });
    actions.appendChild(sel);

    // Ver notícia (se houver URL)
    if(item.url){
      const a=document.createElement('a'); a.textContent='Ver notícia'; a.href=item.url; a.target='_blank'; a.rel='noopener noreferrer'; a.className='btn-news';
      actions.appendChild(a);
    }

    div.appendChild(actions);
    return div;
  }

  // ---------- Agrupar e renderizar categorias ----------
  function groupResults(items){
    const groups = {};
    for(const id of Object.keys(categorias)){
      groups[id] = { label: categorias[id].label, items: [], rendered: 0 };
    }
    items.forEach(it=>{
      const f = it.fonte || '';
      let bucket = 'outros';
      for(const id of Object.keys(categorias)){
        if(id==='outros') continue;
        if(categorias[id].match(f)){ bucket=id; break; }
      }
      groups[bucket].items.push(it);
    });
    const list = Object.entries(groups)
      .filter(([,g])=>g.items.length>0)
      .sort((a,b)=>{
        const diff = b[1].items.length - a[1].items.length;
        if(diff!==0) return diff;
        return catOrder.indexOf(a[0]) - catOrder.indexOf(b[0]);
      });
    return Object.fromEntries(list);
  }

  function renderCategorias(groups){
    categoriasEl.innerHTML='';
    const entries = Object.entries(groups);
    if(entries.length===0){
      categoriasEl.innerHTML = '<p>Nenhum resultado encontrado.</p>';
      return;
    }
    let firstOpened = false;
    for(const [catId, group] of entries){
      const det = document.createElement('details');
      det.className='cat';
      det.dataset.cat = catId;

      const sum = document.createElement('summary');
      const title = document.createElement('span'); title.textContent = group.label;
      const count = document.createElement('span'); count.className='cat-count'; count.textContent = group.items.length;
      sum.appendChild(title); sum.appendChild(count);
      det.appendChild(sum);

      const body = document.createElement('div'); body.className='cat-body';
      const more = document.createElement('div'); more.className='cat-more';
      const moreBtn = document.createElement('button'); moreBtn.className='btn'; moreBtn.textContent='Carregar mais';
      more.appendChild(moreBtn);
      more.style.display='none';

      det.appendChild(body);
      det.appendChild(more);

      // render por demanda
      function renderBatch(append=false){
        const carrinho=getCarrinho();
        const start = group.rendered;
        const end = Math.min(group.items.length, start+PAGE_SIZE);
        if(!append){ body.innerHTML=''; }
        for(let i=start;i<end;i++){
          const card = buildCard(group.items[i], carrinho);
          body.appendChild(card);
        }
        group.rendered = end;
        more.style.display = (group.rendered < group.items.length) ? 'flex' : 'none';
      }

      det.addEventListener('toggle', ()=>{
        if(det.open && group.rendered===0){
          renderBatch(false);
        }
      });
      moreBtn.addEventListener('click', ()=> renderBatch(true) );

      categoriasEl.appendChild(det);

      // Abrir automaticamente? (config acima)
      if(AUTO_OPEN_FIRST && !firstOpened){ det.open = true; firstOpened = true; }
    }
  }

  // ---------- Barra seleção ----------
  function updateBar(){
    const hasSel = getCarrinho().length>0;
    $('#dl-enviar').disabled=!hasSel;
    toggleBar(hasSel);
  }
  function toggleBar(show){
    const bar=$('#dl-bar-selecao');
    bar.style.display=show?'flex':'none';
    wrap.style.paddingBottom = show ? `calc(var(--bar-h) + 14px + var(--safe-bottom))` : '22px';
  }
  $('#dl-enviar').addEventListener('click', ()=>{ window.location.href='index.html#pesquisa'; });
  $('#dl-limpar').addEventListener('click', ()=>{ localStorage.removeItem(KEY); updateBar(); });

  // ---------- Busca ----------
  async function executarBusca(){
    const termoRaw=busca.value.trim();
    categoriasEl.innerHTML='';
    if(!termoRaw){ toggleBar(getCarrinho().length>0); return; }
    btnBuscar.disabled=true; document.body.style.cursor='progress';
    try{
      const { words } = parseLegalQuery(termoRaw);
      const all = baseDados.filter(x=>{
        const hay = x.textoLegal || x.textoNorm;
        return hasAllWords(hay, words);
      });
      const groups = groupResults(all);
      renderCategorias(groups);
      updateBar();
    }finally{
      btnBuscar.disabled=false; document.body.style.cursor='';
    }
  }

  // ---------- Eventos ----------
  btnBuscar.addEventListener('click', executarBusca);
  busca.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); executarBusca(); } });

  // ---------- Boot ----------
  carregarDados().then(d=>{ baseDados=d; toast('Base carregada com sucesso!'); });

})();
</script>
</body>
</html>
