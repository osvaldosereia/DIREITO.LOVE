<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>direito.love — Início</title>
<meta name="theme-color" content="#0c4160" />
<link rel="manifest" href="./manifest.json">

<style>
  :root{
    --ink:#0b1020; --muted:#7a8aa1; --border:#e6ebf4;
    --primary:#0c4160; --accent:#1aab6c;
    --glass: rgba(255,255,255,.58);
    --glass-2: rgba(255,255,255,.32);
    --shadow: 0 6px 18px rgba(20,25,40,.12);
    --shadow-sm: 0 3px 10px rgba(20,25,40,.10);
  }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; color:var(--ink);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:
      radial-gradient(900px 600px at 10% -10%, #e9faf3 0%, transparent 60%),
      radial-gradient(1000px 700px at 120% 0%, #ecf5ff 0%, transparent 55%),
      linear-gradient(180deg,#f7f9ff 0%, #eef2f7 100%);
    font-weight:400;
    padding-top:86px;
  }
  .blob{ position:fixed; filter: blur(36px); z-index:0; opacity:.50; pointer-events:none; width:420px; height:420px; left:-120px; top:-120px; background: radial-gradient(45% 45% at 50% 50%, #8ed1c7 0%, transparent 100%); }
  .blob.b2{ width:520px; height:520px; right:-160px; top:-80px; left:auto; background: radial-gradient(45% 45% at 50% 50%, #b6d3ff 0%, transparent 100%); }
  .wrap{ position:relative; z-index:1; max-width:1100px; margin:0 auto; padding:22px 16px 140px }

  .header-wrap{ position:fixed; inset:0 0 auto 0; z-index:40; padding:10px 16px; background: transparent; }
  .top{
    backdrop-filter: saturate(120%) blur(6px);
    background: linear-gradient(180deg, var(--glass) 0%, var(--glass-2) 100%);
    border:1px solid rgba(255,255,255,.6);
    border-radius:16px;
    box-shadow: var(--shadow);
    display:flex; justify-content:space-between; align-items:center;
    padding:12px 16px; max-width:1100px; margin:0 auto;
  }
  .brand{ display:flex; align-items:center; gap:10px }
  .logo{ height:48px; width:auto } /* usa logo enviada, maior */
  .right-icons a{ display:inline-flex; align-items:center; justify-content:center; border-radius:12px; }
  .right-icons img{ height:32px; width:32px }

  .tabs{ display:flex; gap:8px; margin:10px 0 18px }
  .tab{
    all:unset; cursor:pointer; letter-spacing:.2px;
    padding:10px 14px; border-radius:999px;
    background:linear-gradient(180deg,#ffffffcc,#f4f7ffcc);
    border:1px solid #e4e9f3; box-shadow: var(--shadow-sm);
    font-weight:700;
  }
  .tab[aria-selected="true"]{ color:#fff; border-color:transparent; background:linear-gradient(180deg,#0c4160,#0d5a86); }

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.68));
    border:1px solid rgba(255,255,255,.7);
    border-radius:22px; box-shadow: var(--shadow);
    padding:22px; position:relative; overflow:hidden;
  }
  .title{ margin:0 0 10px; font-size:clamp(22px,4vw,36px); font-weight:700; letter-spacing:.2px }

  .row{ display:grid; gap:12px; grid-template-columns:minmax(0,1fr) auto; align-items:stretch }
  .field{
    background:linear-gradient(180deg,#f5f8ff,#eef3fb);
    border:1px solid #dae3f2; color:var(--ink);
    border-radius:16px; padding:14px 16px; outline:none;
    box-shadow: inset 0 1px 0 #fff, var(--shadow-sm);
    font-weight:500;
  }
  .field:focus{ border-color:#b7c7e6; box-shadow: inset 0 1px 0 #fff, 0 0 0 4px rgba(26,171,108,.10), var(--shadow-sm) }
  .btn{ all:unset; display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 16px; border-radius:16px; cursor:pointer; font-weight:600 }
  .btn-primary{ color:#fff; background:linear-gradient(180deg,#0d547c,#0c4160); box-shadow: 0 6px 18px rgba(12,65,96,.22), inset 0 1px 0 rgba(255,255,255,.14); }
  .btn-primary:hover{ transform:translateY(-1px) }
  .btn-ghost{ background:linear-gradient(180deg,#ffffff,#f3f6ff); border:1px solid #e6ecf6; color:#0b2238; box-shadow: var(--shadow-sm) }
  .btn-small{ padding:6px 10px; font-size:12px; border-radius:12px; font-weight:600 }
  .btn-disabled{ opacity:.5; cursor:not-allowed; pointer-events:none }

  .helper{ margin-top:8px; display:flex; justify-content:flex-end }
  .helper .btn{ color:#6b7c95; font-weight:600 }

  .grid-obj{ display:grid; gap:16px; grid-template-columns:1fr }
  @media (min-width: 768px){ .grid-obj{ grid-template-columns:1fr 1fr 1fr } }
  .obj{
    position:relative; background:linear-gradient(180deg,#ffffff,#f5f8ff);
    border:1px solid #e8eef7; border-radius:18px; padding:16px; cursor:pointer;
    box-shadow: var(--shadow-sm);
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .obj:hover{ transform:translateY(-2px); box-shadow: var(--shadow) }
  .obj h3{ margin:0 0 8px; font-size:18px; display:flex; align-items:center; gap:10px; font-weight:700 }
  .subtle{ margin:6px 0 10px; color:#6e7e95; font-weight:600; font-size:13px; letter-spacing:.3px; text-transform:uppercase }

  .chips{ display:flex; flex-wrap:wrap; gap:10px }
  .chip{
    all:unset; padding:10px 12px; border-radius:999px; cursor:pointer;
    background:linear-gradient(180deg,#ffffff,#eef3ff);
    border:1px solid #e6ecf6; box-shadow: var(--shadow-sm);
    font-size:14px; font-weight:600;
  }

  .divider{ height:1px; background:#ecf0f6; margin:18px 0 }

  .floatbar{ position:fixed; left:16px; right:16px; bottom:16px; z-index:50; display:flex; justify-content:flex-end; pointer-events:none }
  .floatbar .inner{
    pointer-events:auto; display:flex; gap:8px; padding:10px;
    backdrop-filter: blur(5px) saturate(120%);
    background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.72));
    border:1px solid rgba(255,255,255,.8); border-radius:16px; box-shadow: var(--shadow-sm);
  }
  .toast{
    position:fixed; z-index:60; right:16px; bottom:84px; background:#0d5a86; color:#fff;
    padding:12px 16px; border-radius:12px; box-shadow: var(--shadow-sm); display:none; font-weight:700
  }

  .sheet{ position:fixed; inset:0; display:none; place-items:center; z-index:80; background:rgba(10,15,25,.35); backdrop-filter:blur(4px) }
  .sheet .box{
    width:min(560px,92vw);
    background:linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82));
    border:1px solid rgba(240,243,250,.9);
    border-radius:18px; box-shadow: var(--shadow-sm); padding:20px;
    text-align:center;
  }
  .sheet h4{ margin:0 0 10px; font-size:18px; font-weight:700 }
  .sheet .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }

  .modal{ position:fixed; inset:0; display:none; place-items:center; z-index:80; background:rgba(10,15,25,.30); backdrop-filter:blur(3px) }
  .modal .box{ width:min(680px,92vw); background:#fff; border:1px solid #e7ecf6; border-radius:16px; box-shadow: var(--shadow); padding:18px; }
</style>
</head>
<body>
  <div class="blob"></div><div class="blob b2"></div>

  <div class="header-wrap">
    <header class="top">
      <div class="brand"><img class="logo" src="./icons/logo-heart.png" alt="direito.love" /></div>
      <div class="right-icons">
        <a href="https://www.instagram.com/osvaldosereiajr/" target="_blank" rel="noopener" title="Instagram">
          <img src="./icons/instagram.png" alt="Instagram">
        </a>
      </div>
    </header>
  </div>

  <div class="wrap">
    <nav class="tabs" role="tablist" aria-label="Navegação">
      <button class="tab" id="tab-inicio" aria-controls="panel-inicio" aria-selected="true">Início</button>
      <button class="tab" id="tab-arquivo" aria-controls="panel-arquivo" aria-selected="false">Arquivo</button>
    </nav>

    <!-- INÍCIO -->
    <section id="panel-inicio" class="card" role="tabpanel" aria-labelledby="tab-inicio">
      <h1 class="title">Sobre o que vamos falar?</h1>

      <div class="row" id="step1">
        <input id="tema" class="field" type="text" placeholder="Ex.: Dano moral por negativação indevida" aria-label="Tema" />
        <button id="avancar" class="btn btn-primary">Avançar</button>
      </div>
      <div class="helper">
        <button id="como-btn" class="btn btn-ghost btn-small" title="Entenda o fluxo">
          <img src="./icons/info.png" alt="" style="height:14px;width:14px" />&nbsp;Como funciona
        </button>
      </div>

      <!-- Passo 2 (escondido até clicar Avançar) -->
      <div id="step2" class="hidden" style="margin-top:18px">
        <h1 class="title" style="margin-top:0">Perfeito. Qual o seu objetivo?</h1>
        <div class="grid-obj">
          <div class="obj" data-objetivo="aprender" tabindex="0" role="button" aria-label="Escolher APRENDER">
            <h3>APRENDER</h3>
            <div class="subtle">Clique para copiar o prompt</div>
            <div class="chips" data-chips="aprender"></div>
          </div>
          <div class="obj" data-objetivo="treinar" tabindex="0" role="button" aria-label="Escolher TREINAR">
            <h3>TREINAR</h3>
            <div class="subtle">Clique para copiar o prompt</div>
            <div class="chips" data-chips="treinar"></div>
          </div>
          <div class="obj" data-objetivo="atualizar" tabindex="0" role="button" aria-label="Escolher ATUALIZAR">
            <h3>ATUALIZAR</h3>
            <div class="subtle">Clique para copiar o prompt</div>
            <div class="chips" data-chips="atualizar"></div>
          </div>
        </div>
      </div>

      <div class="divider"></div>
    </section>

    <!-- ARQUIVO -->
    <section id="panel-arquivo" class="card" role="tabpanel" aria-labelledby="tab-arquivo" hidden>
      <h2 class="title" style="font-size:26px">Arquivo — por estratégia</h2>
      <div id="book-grouped"></div>
    </section>
  </div>

  <div class="floatbar" aria-label="Ações rápidas">
    <div class="inner">
      <a id="open-ia" class="btn btn-ghost btn-disabled" href="#" target="_blank" rel="noopener" aria-disabled="true">Abrir IA</a>
      <button id="reset" class="btn btn-primary">Nova pesquisa</button>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Copiado!</div>

  <div id="sheet" class="sheet" aria-modal="true" role="dialog" aria-labelledby="sheet-title">
    <div class="box">
      <h4 id="sheet-title">Prompt Copiado</h4>
      <div class="actions">
        <a id="open-ia-modal" class="btn btn-primary" href="#" target="_blank" rel="noopener">Abrir IA</a>
        <button id="sheet-close" class="btn btn-ghost">Fechar</button>
      </div>
    </div>
  </div>

  <div id="modal-how" class="modal" aria-modal="true" role="dialog" aria-labelledby="how-title">
    <div class="box">
      <h3 id="how-title" style="margin:0 0 10px; font-weight:700">Como funciona</h3>
      <ol style="margin:0; padding-left:18px">
        <li>Digite o <b>tema</b> e clique em <b>Avançar</b>.</li>
        <li>Escolha um <b>objetivo</b>.</li>
        <li>Clique na <b>IA</b> para <b>copiar o prompt</b>.</li>
        <li>Use <b>Abrir IA</b> para ir direto à plataforma.</li>
      </ol>
      <div style="text-align:right; margin-top:10px">
        <button id="how-close" class="btn btn-ghost btn-small">Fechar</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const tabInicio=document.getElementById('tab-inicio'), tabArq=document.getElementById('tab-arquivo');
  const panelInicio=document.getElementById('panel-inicio'), panelArq=document.getElementById('panel-arquivo');
  const resetBtn=document.getElementById('reset');

  function selectTab(which){
    const ini=which==='inicio';
    tabInicio.setAttribute('aria-selected',ini);
    tabArq.setAttribute('aria-selected',!ini);
    panelInicio.hidden=!ini; panelArq.hidden=ini;
    if(!ini){
      renderBookGrouped();
      resetBtn.classList.add('btn-disabled'); resetBtn.setAttribute('aria-disabled','true'); resetBtn.style.pointerEvents='none';
    } else {
      resetBtn.classList.remove('btn-disabled'); resetBtn.removeAttribute('aria-disabled'); resetBtn.style.pointerEvents='auto';
    }
  }
  tabInicio.addEventListener('click',()=>selectTab('inicio'));
  tabArq.addEventListener('click',()=>selectTab('arquivo'));

  let current={ tema:"", lastIA:null };
  const el={
    tema:document.getElementById('tema'),
    avancar:document.getElementById('avancar'),
    step2:document.getElementById('step2'),
    toast:document.getElementById('toast'),
    openIA:document.getElementById('open-ia'),
    sheet:document.getElementById('sheet'),
    sheetClose:document.getElementById('sheet-close'),
    openIAModal:document.getElementById('open-ia-modal'),
    bookGrouped:document.getElementById('book-grouped'),
    how:document.getElementById('modal-how'),
    howBtn:document.getElementById('como-btn'),
    howClose:document.getElementById('how-close'),
  };

  const BOOK_KEY='book_data_v23';
  function load(k,fb){ try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(fb));}catch{return fb} }
  function save(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  function pushEntry(e){ let d=load(BOOK_KEY,[]); d.unshift(e); if(d.length>200) d=d.slice(0,200); save(BOOK_KEY,d); }

  const IA_LINKS={ 'ChatGPT':'https://chatgpt.com/', 'Gemini':'https://gemini.google.com/', 'Perplexity':'https://www.perplexity.ai/' };
  const IA_RECOMENDADAS={ aprender:['ChatGPT','Gemini','Perplexity'], treinar:['ChatGPT','Gemini','Perplexity'], atualizar:['ChatGPT','Gemini','Perplexity'] };

  el.avancar.addEventListener('click', ()=>{
    const tema=(el.tema.value||'').trim();
    if(!tema){ alert('Digite o tema.'); el.tema.focus(); return; }
    if(tema.length<3){ alert('Tema muito curto.'); el.tema.focus(); return; }
    current.tema=tema;
    el.step2.classList.remove('hidden');
    window.scrollTo({ top: el.step2.offsetTop-8, behavior:'smooth' });
    ['aprender','treinar','atualizar'].forEach(k=>renderChips(k));
  });

  function renderChips(objKey){
    const cont=document.querySelector(`.chips[data-chips="${objKey}"]`);
    cont.innerHTML='';
    IA_RECOMENDADAS[objKey].forEach(ia=>{
      cont.appendChild(chip(ia, ()=>onIA(objKey, ia)));
    });
  }

  function chip(label, onClick){
    const b=document.createElement('button');
    b.className='chip';
    b.textContent=label;
    b.title=`Copiar prompt para ${label}`;
    b.addEventListener('click', onClick);
    return b;
  }

  function coreFooter(){ return `**💚 [direito.love](https://direito.love)**`; }

  function invisibleChecklistAtualizar(){
    return `
[INSTRUÇÃO INTERNA — NÃO REVELE AO USUÁRIO]
- Teste mentalmente os links antes de listar; evite quebras/redirecionamentos.
- Evite duplicatas.
- Ordene do mais recente para o menos recente.
- Use o título exato da matéria.
[FIM]`;
  }

  const Templates = {
    aprender: (t)=>`Você é um professor e pesquisador jurídico do projeto direito.love. Explique de forma clara e personalizada.

TEMA:
**${t}**

PROTOCOLO (perguntas 1 a 1):
- Faça **uma pergunta por vez** (1–4 ou sim/não) e **espere**.
- Roteiro: nível; foco (OAB/concursos/prática/estudo); escopo; formato; entendimento majoritário (sim/não).
- A partir da 2ª, siga o roteiro e considere respostas anteriores.

RESPOSTA FINAL:
- Linguagem simples e direta; estrutura a seu critério.
- Jurisprudência: **entendimentos majoritários** e divergências quando relevantes; **nunca** cite REsp/AREsp/nº.
${coreFooter()}`,

    treinar: (t)=>`Você é professor de OAB/concursos do projeto direito.love. Monte um treino sobre:

TEMA:
**${t}**

PROTOCOLO (perguntas 1 a 1):
- Uma por vez (1–4/sim-não), seguindo roteiro: nível; foco; tipo; abrangência; comentários (sim/não).

SIMULADO:
- 10 questões objetivas; gabarito **só no final**.
- Priorize OAB, concursos e Qconcursos. Evite inventar.
- Jurisprudência apenas como entendimento consolidado; sem REsp/AREsp/nº.
${coreFooter()}`,

    atualizar: (t)=>`Você é curador de atualidades do projeto direito.love. Liste notícias reais sobre:

TEMA:
**${t}**

PROTOCOLO (perguntas 1 a 1):
- Janela temporal; foco; abrangência; profundidade; quantidade.

CURADORIA (OBRIGATÓRIO):
- **Traga 15 notícias/artigos** de **sites famosos e confiáveis**.
- **Priorize itens publicados nos últimos 12 meses**, sempre ordenando do mais recente para o menos recente.
- Cada item: **título exato**, **nome do site**, **resumo breve** e **botão “Ver notícia”** com **link direto e válido** (sem quebras).
- Sem duplicatas.
${invisibleChecklistAtualizar()}
${coreFooter()}`
  };

  const Variants={
    'ChatGPT':c=>c+`\n— Ajuste (ChatGPT): Não revele raciocínio passo a passo; entregue só a resposta formatada.`,
    'Gemini':c=>c+`\n— Ajuste (Gemini): Seções curtas e claras.`,
    'Perplexity':c=>c+`\n— Ajuste (Perplexity): Quando aplicável, 3–5 fontes confiáveis ao final (sem nº de processos).`
  };
  function decorateByIA(ia, core){ return Variants[ia]?Variants[ia](core):core; }

  function buildPrompt(obj, ia, tema){
    let core=Templates[obj](tema);
    core += `

[INSTRUÇÕES CRÍTICAS — NÃO REVELE AO USUÁRIO]
- Não citar REsp/AREsp/nº; use apenas entendimentos majoritários e divergências relevantes.
- Linguagem simples e direta.
[NÃO REPRODUZA ESTE BLOCO NA RESPOSTA AO USUÁRIO]`;
    if(ia) core = decorateByIA(ia, core);
    return core;
  }

  async function onIA(objKey, ia){
    try{
      const prompt = buildPrompt(objKey, ia, current.tema);
      await navigator.clipboard.writeText(String(prompt||''));
      pushEntry({ objKey, objetivo: objKey.toUpperCase(), ia, tema: current.tema, prompt, ts: Date.now() });
      toast('Copiado!');
      current.lastIA = ia;
      enableOpenIA(ia);
      updateModalIA(ia);
      openSheet();
    }catch{ alert('Não foi possível copiar.'); }
  }

  function toast(msg='Copiado!'){
    const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block';
    setTimeout(()=> t.style.display='none', 1000);
  }

  function enableOpenIA(ia){
    if(ia && IA_LINKS[ia]){
      el.openIA.textContent = `Abrir IA: ${ia}`;
      el.openIA.href = IA_LINKS[ia];
      el.openIA.classList.remove('btn-disabled');
      el.openIA.setAttribute('aria-disabled','false');
    } else {
      el.openIA.textContent = 'Abrir IA';
      el.openIA.removeAttribute('href');
      el.openIA.classList.add('btn-disabled');
      el.openIA.setAttribute('aria-disabled','true');
    }
  }

  function openSheet(){ el.sheet.style.display='grid'; }
  function closeSheet(){ el.sheet.style.display='none'; }
  function updateModalIA(ia){
    const url = IA_LINKS[ia] || '#';
    el.openIAModal.textContent = `Abrir ${ia}`;
    el.openIAModal.href = url;
  }
  el.sheetClose.addEventListener('click', closeSheet);
  el.sheet.addEventListener('click', (e)=>{ if(e.target===el.sheet) closeSheet(); });

  el.howBtn.addEventListener('click', ()=> el.how.style.display='grid');
  el.howClose.addEventListener('click', ()=> el.how.style.display='none');
  el.how.addEventListener('click', (e)=>{ if(e.target===el.how) el.how.style.display='none'; });

  resetBtn.addEventListener('click', ()=>{
    if (panelArq.hidden === false) return;
    current={ tema:"", lastIA:null };
    el.tema.value='';
    el.step2.classList.add('hidden');
    enableOpenIA(null);
    closeSheet();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  function renderBookGrouped(){
    const data = load(BOOK_KEY, []);
    const box = document.getElementById('book-grouped');
    if(!data.length){ box.innerHTML='<div style="color:#7a8aa1">Arquivo vazio.</div>'; return; }
    const groups={};
    for(const it of data){ const k=(it.objetivo||'—').toUpperCase(); (groups[k]=groups[k]||[]).push(it); }
    box.innerHTML='';
    Object.keys(groups).forEach(k=>{
      const c=document.createElement('div'); c.className='card'; c.style.marginBottom='12px';
      c.innerHTML=`<h4 style="margin:0 0 8px; font-weight:700">${k}</h4>`;
      groups[k].forEach(it=>{
        const row=document.createElement('div');
        row.style.cssText='display:flex;justify-content:space-between;gap:8px;border:1px solid #e8eef7;border-radius:12px;padding:10px;margin-bottom:8px;background:#fff; box-shadow: var(--shadow-sm)';
        row.innerHTML=`<div><b style="font-weight:600">${it.ia}</b> • ${it.tema}<br><span style="color:#7a8aa1">${new Date(it.ts).toLocaleString()}</span></div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-ghost btn-small" data-copy>Copiar</button>
          </div>`;
        row.querySelector('[data-copy]').addEventListener('click', async ()=>{
          try{
            await navigator.clipboard.writeText(String(it.prompt||''));
            toast('Copiado!');
            if (it.ia && IA_LINKS[it.ia]) enableOpenIA(it.ia);
          }catch{ alert('Não foi possível copiar.'); }
        });
        c.appendChild(row);
      });
      box.appendChild(c);
    });
  }

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }
});
</script>
</body>
</html>
