<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>direito.love ‚Äî Estudo 3-em-1</title>
<meta name="theme-color" content="#ffffff" />
<link rel="manifest" href="./manifest.json">

<style>
  /* ===== Tema preto & branco estilo ChatGPT (apenas cora√ß√£o verde) ===== */
  :root{
    --bg:#ffffff; --panel:#f7f7f8; --input:#ffffff;
    --text:#0b0c0d; --muted:#6b7280; --border:#d9d9e3;
    --accent:#10a37f;       /* √öNICO toque de cor (cora√ß√£o) */
    --shadow:0 6px 18px rgba(0,0,0,.08);
    --radius:14px;
  }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font: 400 15px/1.55 "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }

  /* Topbar fixo: cora√ß√£o + nome √† esquerda; Instagram √† direita */
  .top{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(180deg,#fff,#f7f7f8);
    border-bottom:1px solid var(--border);
    padding:10px 16px; display:flex; align-items:center; justify-content:space-between;
  }
  .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px }
  .heart{
    width:20px; height:20px; display:inline-block;
    background-color:var(--accent);
    -webkit-mask:url('/icons/logo-heart.png') no-repeat center/contain;
            mask:url('/icons/logo-heart.png') no-repeat center/contain;
  }
  .right-icons{ display:flex; align-items:center; gap:12px }
  .icon{
    width:20px; height:20px; display:inline-block;
    background-color:#0b0c0d; /* 1 cor */
    -webkit-mask:url('/icons/instagram.png') no-repeat center/contain;
            mask:url('/icons/instagram.png') no-repeat center/contain;
  }

  /* Layout principal */
  .wrap{ max-width:880px; margin:0 auto; padding:22px 16px 160px }

  /* √Årea de chat */
  .chat{
    display:flex; flex-direction:column; gap:10px;
    background:var(--panel); border:1px solid var(--border);
    border-radius:var(--radius); padding:16px; box-shadow:var(--shadow);
  }
  .msg{
    max-width:86%; padding:10px 12px; border:1px solid var(--border);
    border-radius:12px; background:#fff;
  }
  .msg.bot{
    align-self:flex-start; background:#fff;
  }
  .msg.user{
    align-self:flex-end; background:#fff;
  }
  .meta{ color:var(--muted); font-size:12px; margin-top:4px }

  /* Campo de entrada (aparece s√≥ quando for a hora) */
  .composer{
    display:flex; gap:8px; margin-top:8px;
  }
  .field{
    flex:1; background:var(--input); color:var(--text);
    border:1px solid var(--border); outline:none;
    padding:10px 12px; border-radius:12px; font-weight:500;
  }
  .field::placeholder{ color:#9aa0a6 }
  .btn{
    all:unset; cursor:pointer; user-select:none;
    padding:10px 12px; border-radius:11px;
    display:inline-flex; align-items:center; justify-content:center; gap:6px;
    font-weight:700; transition:transform .08s ease, opacity .2s ease;
    border:1px solid var(--border); background:#fff; color:#0b0c0d;
  }
  .btn:active{ transform:translateY(1px) }
  .btn.small{ padding:8px 10px; font-size:12px; border-radius:10px }
  .btn.primary{ background:#0b0c0d; color:#fff; }  /* bot√µes pequenos, preto */
  .btn.ghost{ background:#fff; color:#0b0c0d; }

  .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:4px }
  .chip{ all:unset; cursor:pointer; border:1px solid var(--border); background:#fff; color:#0b0c0d;
         padding:8px 10px; border-radius:999px; font-weight:700; font-size:13px }
  .chip:active{ transform:translateY(1px) }

  /* Tabs m√≠nimas para Arquivo */
  .tabs{ display:flex; gap:8px; margin:12px 0 16px }
  .tab{ all:unset; cursor:pointer; padding:8px 12px; border:1px solid var(--border); border-radius:999px; font-weight:700; }
  .tab[aria-selected="true"]{ background:#eef1f4 }

  /* Barra flutuante base ‚Äî bot√µes pequenos, centralizados */
  .floatbar{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%); z-index:30; pointer-events:none;
  }
  .floatbar .inner{
    pointer-events:auto; display:flex; gap:8px; padding:6px 8px;
    background:#ffffffcc; border:1px solid var(--border); border-radius:12px;
    box-shadow:var(--shadow); align-items:center; justify-content:center;
    backdrop-filter:saturate(140%) blur(4px);
  }

  /* Modal central (Ir para IA / Fechar) */
  .sheet{ position:fixed; inset:0; display:none; place-items:center; z-index:50; background:rgba(0,0,0,.35); backdrop-filter:blur(2px) }
  .sheet .box{
    width:min(520px,92vw); background:#fff; color:#0b0c0d;
    border:1px solid var(--border); border-radius:14px; box-shadow:var(--shadow); padding:16px; text-align:center;
  }
  .sheet h4{ margin:0 0 8px; font-size:16px; font-weight:800 }
  .sheet .actions{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:8px }

  /* Toast */
  .toast{
    position:fixed; z-index:60; left:50%; bottom:120px; transform:translateX(-50%);
    background:#0b0c0d; color:#fff; padding:8px 10px; border-radius:10px; display:none; font-weight:800; font-size:12px
  }

  /* Cart√£o Arquivo */
  .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow) }
  .title{ margin:0 0 10px; font-size:18px; font-weight:800 }
  .entry{ border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff; display:flex; justify-content:space-between; gap:8px; margin-bottom:8px }
  .muted{ color:var(--muted) }

</style>
</head>
<body>
  <!-- Topo fixo -->
  <header class="top">
    <div class="brand"><i class="heart" aria-hidden="true"></i><span>direito.love</span></div>
    <div class="right-icons">
      <a href="https://www.instagram.com/osvaldosereiajr/" target="_blank" rel="noopener" title="Instagram" aria-label="Instagram"><i class="icon" aria-hidden="true"></i></a>
    </div>
  </header>

  <main class="wrap">
    <!-- Abas: In√≠cio / Arquivo -->
    <nav class="tabs" role="tablist" aria-label="Navega√ß√£o">
      <button class="tab" id="tab-inicio" aria-controls="panel-inicio" aria-selected="true">In√≠cio</button>
      <button class="tab" id="tab-arquivo" aria-controls="panel-arquivo" aria-selected="false">Arquivo</button>
    </nav>

    <!-- Painel In√≠cio (chat) -->
    <section id="panel-inicio" role="tabpanel" aria-labelledby="tab-inicio">
      <div id="chat" class="chat" aria-live="polite"></div>
    </section>

    <!-- Painel Arquivo -->
    <section id="panel-arquivo" role="tabpanel" aria-labelledby="tab-arquivo" hidden>
      <div class="card">
        <h2 class="title">Arquivo ‚Äî prompts copiados</h2>
        <div id="book" class="muted" style="font-size:14px">Carregando‚Ä¶</div>
      </div>
    </section>
  </main>

  <!-- Barra base fixa: Arquivo / Nova pesquisa -->
  <div class="floatbar">
    <div class="inner">
      <button id="btn-arquivo" class="btn small ghost">Arquivo</button>
      <button id="btn-reset" class="btn small primary">Nova pesquisa</button>
    </div>
  </div>

  <!-- Modal centro -->
  <div id="sheet" class="sheet" aria-modal="true" role="dialog" aria-labelledby="sheet-title">
    <div class="box">
      <h4 id="sheet-title">Prompt Copiado</h4>
      <div class="actions">
        <a id="open-ia-modal" class="btn primary" href="#" target="_blank" rel="noopener">Ir para a IA</a>
        <button id="sheet-close" class="btn ghost">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast">Copiado!</div>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Estado & refs ===== */
  const chat = document.getElementById('chat');
  const panelInicio = document.getElementById('panel-inicio');
  const panelArquivo = document.getElementById('panel-arquivo');
  const tabInicio = document.getElementById('tab-inicio');
  const tabArquivo = document.getElementById('tab-arquivo');
  const btnArquivo = document.getElementById('btn-arquivo');
  const btnReset = document.getElementById('btn-reset');
  const sheet = document.getElementById('sheet');
  const sheetClose = document.getElementById('sheet-close');
  const openIAModal = document.getElementById('open-ia-modal');
  const toastEl = document.getElementById('toast');

  let current = { tema:"", lastIA:null };
  const BOOK_KEY = 'book_data_v29';
  const IA_LINKS = { ChatGPT:'https://chatgpt.com/', Gemini:'https://gemini.google.com/', Perplexity:'https://www.perplexity.ai/' };

  /* ===== Util ===== */
  function toast(msg='Copiado!'){ toastEl.textContent=msg; toastEl.style.display='block'; setTimeout(()=>toastEl.style.display='none', 1200); }
  function nowTimeGreeting(){
    const h = new Date().getHours();
    if (h < 6) return 'boa noite';
    if (h < 12) return 'bom dia';
    if (h < 18) return 'boa tarde';
    return 'boa noite';
  }
  const GREETINGS = [
    "como voc√™ t√°? tudo certo por a√≠?",
    "pronto pra estudar e gabaritar?",
    "bora transformar estudo em aprova√ß√£o?",
    "seguinte: eu te ajudo com o tema e a estrat√©gia.",
    "partiu focar s√≥ no que cai em prova?",
    "hoje √© dia de avan√ßo. conto contigo?",
    "meta simples: acerto na prova. vamos?",
    "t√¥ aqui pra acelerar seu estudo.",
    "sem rodeio: quer passar, eu te ajudo.",
    "vamos direto ao ponto pra OAB/concurso?"
  ];

  function addMsg(text, who='bot', html=false){
    const wrap = document.createElement('div');
    wrap.className = 'msg '+(who==='user'?'user':'bot');
    wrap.innerHTML = html ? text : escapeHtml(text).replace(/\n/g,'<br>');
    chat.appendChild(wrap);
    chat.scrollTop = chat.scrollHeight;
    return wrap;
  }
  function escapeHtml(s){ return s.replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c])); }

  function selectTab(which){
    const ini = which==='inicio';
    tabInicio.setAttribute('aria-selected', ini);
    tabArquivo.setAttribute('aria-selected', !ini);
    panelInicio.hidden = !ini;
    panelArquivo.hidden = ini;
    if (!ini) renderArquivo();
  }

  /* ===== Composer (aparece s√≥ quando for a hora) ===== */
  let composerEl = null, inputEl = null, sendBtn = null;
  function showComposer(placeholder='Digite o tema com precis√£o‚Ä¶'){
    if (composerEl) return;
    composerEl = document.createElement('div');
    composerEl.className = 'composer';
    inputEl = document.createElement('input');
    inputEl.className = 'field';
    inputEl.placeholder = placeholder;
    inputEl.id = 'tema';
    sendBtn = document.createElement('button');
    sendBtn.className = 'btn primary';
    sendBtn.textContent = 'Enviar';
    composerEl.appendChild(inputEl);
    composerEl.appendChild(sendBtn);
    chat.appendChild(composerEl);
    inputEl.focus();

    sendBtn.addEventListener('click', submitTema);
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ submitTema(); } });
    chat.scrollTop = chat.scrollHeight;
  }
  function hideComposer(){
    if (!composerEl) return;
    composerEl.remove(); composerEl=null; inputEl=null; sendBtn=null;
  }

  /* ===== Fluxo inicial ===== */
  function startFlow(){
    const greet = nowTimeGreeting();
    addMsg(`${greet}! ${GREETINGS[Math.floor(Math.random()*GREETINGS.length)]}`);
    addMsg("sobre o que vamos falar hoje?\nüìå dica: seja espec√≠fico no tema (ex.: ‚Äúdano moral x dano est√©tico na OAB‚Äù).");
    showComposer();
  }

  async function submitTema(){
    const tema = (inputEl?.value || '').trim();
    if (!tema){ inputEl?.focus(); return; }
    addMsg(tema, 'user');
    current.tema = tema;
    hideComposer();

    // ‚Äúpensando‚Ä¶‚Äù 3s
    const thinking = addMsg('ok, vamos produzir seu prompt‚Ä¶');
    thinking.classList.add('meta');
    await waitMs(3000);

    // entregue os 3 bot√µes de IA
    addMsg('pronto! escolha uma das tr√™s IAs e clique para copiar o prompt. depois √© s√≥ colar na sua IA preferida.', 'bot');
    renderIAChoices();
  }
  function waitMs(ms){ return new Promise(res=>setTimeout(res, ms)); }

  function renderIAChoices(){
    const box = document.createElement('div');
    box.className = 'msg bot';
    const row = document.createElement('div');
    row.className = 'chips';
    ['ChatGPT','Gemini','Perplexity'].forEach(ia=>{
      const b = document.createElement('button');
      b.className = 'chip';
      b.textContent = ia;
      b.addEventListener('click', ()=> onIA(ia));
      row.appendChild(b);
    });
    box.appendChild(row);
    chat.appendChild(box);
    chat.scrollTop = chat.scrollHeight;
  }

  /* ===== Prompts 3-em-1 ===== */
  function footer(){ return '**üíö [direito.love](https://direito.love)**\\nGere um novo prompt em [direito.love](https://direito.love)'; }

  function promptGPT(t){
    return (
`Voc√™ √© um **professor de Direito especializado em prepara√ß√£o para provas, OAB e concursos**, escolhido pelo projeto **direito.love**. Sua miss√£o √© conduzir o aluno por uma jornada completa sobre:

**TEMA:**  
**${t}**

A jornada ter√° **3 etapas sequenciais**:
1. Explica√ß√£o did√°tica (APRENDER)  
2. Simulado com gabarito (TREINAR)  
3. Dicas de prova e pegadinhas (DESCOBRIR)

‚ö†Ô∏è Ao final de **cada etapa**, pare e pergunte:  
‚û°Ô∏è ‚ÄúQuer continuar?‚Äù

---

# üìò ETAPA 1 ‚Äî APRENDER
- Explique o conceito em at√© 6 linhas, focando no que cai na OAB/concursos.  
- D√™ 1‚Äì2 exemplos t√≠picos de prova.  
- Traga o entendimento consolidado do STJ/STF (sem n√∫meros de processo).  
- Liste 2‚Äì3 pegadinhas cl√°ssicas.

üëâ Encerrando a etapa:  
‚û°Ô∏è *‚ÄúQuer continuar para a etapa de treino?‚Äù*

---

# üìù ETAPA 2 ‚Äî TREINAR
- Monte **5 quest√µes objetivas** (4 alternativas, 1 correta).  
- Linguagem de banca.  
- **Gabarito comentado no final.**

üëâ Encerrando a etapa:  
‚û°Ô∏è *‚ÄúQuer ver agora 10 dicas pr√°ticas pra acertar mais quest√µes?‚Äù*

---

# üîé ETAPA 3 ‚Äî DESCOBRIR
- Liste **10 dicas de prova**: diferen√ßas sutis, confus√µes frequentes, palavras-chave e pegadinhas.

${footer()}`
    );
  }
  function promptGemini(t){
    return (
`Voc√™ √© um **professor jur√≠dico experiente**, do projeto **direito.love**, e vai ensinar **${t}** em 3 etapas distintas para **provas, OAB e concursos**.

‚ö†Ô∏è Regras de fluxo:
- Responda **somente a etapa atual**.
- Ao final de cada etapa, **pergunte se o aluno quer continuar** e **aguarde a resposta**.

---

## üìò ETAPA 1 ‚Äî APRENDER
- Conceito em at√© 6 linhas (linguagem clara).  
- Exemplo objetivo estilo OAB.  
- Posi√ß√£o dominante do STJ/STF (sem REsp/AREsp/n¬∫).  
- 2 pegadinhas comuns de prova.

üëâ Final da etapa. Aguarde com:  
‚û°Ô∏è *‚ÄúDeseja continuar para a pr√≥xima etapa (treinar)?‚Äù*

---

## üìù ETAPA 2 ‚Äî TREINAR
- 5 quest√µes (4 alternativas, 1 correta), estilo banca.  
- Ao final, **gabarito com coment√°rios curtos**.

üëâ Final da etapa. Aguarde com:  
‚û°Ô∏è *‚ÄúVamos para 10 dicas pr√°ticas de prova?‚Äù*

---

## üîé ETAPA 3 ‚Äî DESCOBRIR
- 10 dicas √∫teis para acertar quest√µes (diferen√ßas conceituais, confus√µes recorrentes, termos de enunciado, erros cl√°ssicos).

${footer()}`
    );
  }
  function promptPerplexity(t){
    return (
`Voc√™ √© um professor de Direito para preparar alunos para **OAB e concursos**.

TEMA: **${t}**

Responda por etapas.  
‚ö†Ô∏è Ao final de cada etapa, pergunte se deseja continuar.  
N√£o junte as 3 respostas de uma vez.

---

### üìò ETAPA 1 ‚Äî APRENDER
- Conceito claro (at√© 6 linhas)  
- Exemplo objetivo  
- Entendimento atual do STJ/STF (sem REsp/AREsp)  
- Pegadinhas comuns

‚ùì *Quer passar para a pr√≥xima etapa (treinar)?*

---

### üìù ETAPA 2 ‚Äî TREINAR
- 5 quest√µes de m√∫ltipla escolha, estilo banca  
- Gabarito no final **com justificativas curtas**

‚ùì *Vamos para a √∫ltima etapa (10 dicas de prova)?*

---

### üîé ETAPA 3 ‚Äî DESCOBRIR
- 10 dicas para acertar quest√µes (erros comuns, confus√µes, atalhos de memoriza√ß√£o).  
- Seja direto: foco em **acertar a prova**.

${footer()}`
    );
  }
  function buildPrompt(ia, tema){
    if(ia==='ChatGPT') return promptGPT(tema);
    if(ia==='Gemini') return promptGemini(tema);
    if(ia==='Perplexity') return promptPerplexity(tema);
    return '';
  }

  /* ===== Clique nas IAs: copia + modal ===== */
  async function onIA(ia){
    try{
      const prompt = buildPrompt(ia, current.tema);
      await navigator.clipboard.writeText(String(prompt||''));
      // salva no arquivo
      pushEntry({ objetivo:'3-em-1', ia, tema: current.tema, prompt, ts: Date.now() });
      toast('Copiado!');
      current.lastIA = ia;
      // modal
      openIAModal.textContent = 'Ir para '+ia;
      openIAModal.href = IA_LINKS[ia] || '#';
      openSheet();
    }catch{
      alert('N√£o foi poss√≠vel copiar. Verifique as permiss√µes do navegador.');
    }
  }

  /* ===== Sheet ===== */
  function openSheet(){ sheet.style.display='grid'; }
  function closeSheet(){ sheet.style.display='none'; }
  sheetClose.addEventListener('click', closeSheet);
  sheet.addEventListener('click', (e)=>{ if(e.target===sheet) closeSheet(); });

  /* ===== Arquivo (lista) ===== */
  function load(k,fb){ try{ return JSON.parse(localStorage.getItem(k)||JSON.stringify(fb)); }catch{ return fb } }
  function save(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  function pushEntry(e){ let d=load(BOOK_KEY,[]); d.unshift(e); if(d.length>300) d=d.slice(0,300); save(BOOK_KEY,d); }
  function renderArquivo(){
    const box = document.getElementById('book');
    const data = load(BOOK_KEY, []);
    if (!data.length){ box.innerHTML = '<span class="muted">Arquivo vazio.</span>'; return; }
    const html = data.map(it=>{
      const dt = new Date(it.ts).toLocaleString();
      return `<div class="entry">
        <div><b>${it.ia}</b> ‚Ä¢ ${escapeHtml(it.tema)}<br><span class="muted">${dt}</span></div>
        <div style="display:flex;gap:6px">
          <button class="btn small ghost" data-copy-prompt>Copiar</button>
        </div>
      </div>`;
    }).join('');
    box.innerHTML = html;
    // bind copiar
    box.querySelectorAll('[data-copy-prompt]').forEach((btn,i)=>{
      btn.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(String(data[i].prompt||''));
          toast('Copiado!');
        }catch{
          alert('N√£o foi poss√≠vel copiar.');
        }
      });
    });
  }

  /* ===== Abas e bot√µes base ===== */
  function goInicio(){ selectTab('inicio'); }
  function goArquivo(){ selectTab('arquivo'); }
  tabInicio.addEventListener('click', goInicio);
  tabArquivo.addEventListener('click', goArquivo);
  btnArquivo.addEventListener('click', goArquivo);

  btnReset.addEventListener('click', ()=>{
    goInicio();
    current = { tema:"", lastIA:null };
    chat.innerHTML = '';
    closeSheet();
    startFlow();
    window.scrollTo({ top: 0, behavior:'smooth' });
  });

  /* ===== Inicia conversa ===== */
  startFlow();

  /* ===== PWA SW (opcional; n√£o atrapalha) ===== */
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }
});
</script>
</body>
</html>
