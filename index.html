<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>direito.love ‚Äî Estudo 3-em-1</title>
<meta name="theme-color" content="#ffffff" />
<link rel="manifest" href="./manifest.json">

<style>
  /* ===== Tema claro estilo ChatGPT ===== */
  :root{
    --bg:#ffffff;         /* fundo */
    --panel:#f7f7f8;      /* cart√µes/pain√©is */
    --input:#ffffff;      /* inputs */
    --text:#0c0d0e;       /* texto principal */
    --muted:#6b7280;      /* texto secund√°rio */
    --border:#d9d9e3;     /* bordas */
    --accent:#10a37f;     /* verde ChatGPT */
    --shadow:0 6px 18px rgba(0,0,0,.08);
    --radius:12px;
  }
  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font: 400 16px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }

  /* Topbar minimal, sem logo duplicada */
  .top{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg,#ffffff,#f7f7f8);
    border-bottom:1px solid var(--border);
    padding:10px 16px; display:flex; align-items:center; justify-content:space-between;
  }
  .brand{ font-weight:800; letter-spacing:.2px }
  .right-icons { display:flex; align-items:center; gap:12px }
  /* √çcone Instagram 1 cor via CSS mask */
  .icon{
    width:22px; height:22px; display:inline-block;
    background-color:#0c0d0e; /* cor s√≥lida √∫nica */
    -webkit-mask: url('/icons/instagram.png') no-repeat center / contain;
            mask: url('/icons/instagram.png') no-repeat center / contain;
  }

  .wrap{ max-width:900px; margin:0 auto; padding:22px 16px 180px }
  .card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:18px;
  }
  .title{ margin:0 0 14px; font-size:20px; font-weight:800 }

  /* Tabs */
  .tabs{ display:flex; gap:8px; margin:10px 0 18px }
  .tab{
    all:unset; cursor:pointer; letter-spacing:.2px;
    padding:10px 14px; border-radius:999px;
    color:var(--text); border:1px solid var(--border);
    font-weight:700; background:#fff;
  }
  .tab[aria-selected="true"]{ background:#eef1f4; }

  /* Form coluna: bot√£o embaixo do input */
  .stack{ display:flex; flex-direction:column; gap:10px; align-items:stretch }
  .field{
    background:var(--input); color:var(--text);
    border:1px solid var(--border); outline:none;
    padding:12px 14px; border-radius:var(--radius); font-weight:500;
  }
  .field::placeholder{ color:#9aa0a6 }
  .field:focus{ border-color:#b4b7c5 }

  .btn{
    all:unset; cursor:pointer; user-select:none;
    padding:12px 16px; border-radius:var(--radius);
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    font-weight:700; transition:transform .08s ease, opacity .2s ease;
  }
  .btn:active{ transform:translateY(1px) }

  .btn-primary{ background:var(--accent); color:#ffffff }
  .btn-ghost{ background:#ffffff; color:var(--text); border:1px solid var(--border) }
  .btn-small{ padding:8px 10px; font-size:12px; border-radius:8px }
  .btn-disabled{ opacity:.55; pointer-events:none }

  .chips{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
  .chip{
    all:unset; padding:10px 14px; border-radius:999px; cursor:pointer;
    background:#ffffff; color:var(--text); border:1px solid var(--border);
    font-weight:700;
  }
  .chip:hover{ background:#eef1f4 }

  .divider{ height:1px; background:var(--border); margin:18px 0 }
  .hidden{ display:none !important; }

  /* Barra flutuante base (Abrir IA / Nova pesquisa) */
  .floatbar{ position:fixed; left:16px; right:16px; bottom:16px; z-index:50; display:flex; justify-content:flex-end; pointer-events:none }
  .floatbar .inner{
    pointer-events:auto; display:flex; gap:8px; padding:10px;
    background:#ffffffcc; border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow);
    backdrop-filter:saturate(140%) blur(4px);
  }

  /* Banner instalar app (aparece no in√≠cio, acima da floatbar) */
  .install-banner{
    position:fixed; left:16px; right:16px; bottom:86px; z-index:49;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    background:#ffffff; border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:12px 14px;
  }
  .install-banner p{ margin:0; color:var(--text); font-weight:700 }
  .install-actions{ display:flex; gap:8px; flex-wrap:wrap }

  .toast{
    position:fixed; z-index:60; right:16px; bottom:150px; background:var(--accent); color:#ffffff;
    padding:10px 14px; border-radius:12px; display:none; font-weight:800
  }

  /* Modal (janela central j√° existente) */
  .sheet{ position:fixed; inset:0; display:none; place-items:center; z-index:80; background:rgba(0,0,0,.35); backdrop-filter:blur(2px) }
  .sheet .box{
    width:min(560px,92vw);
    background:#ffffff; color:var(--text);
    border:1px solid var(--border);
    border-radius:var(--radius); box-shadow:var(--shadow); padding:20px;
    text-align:center;
  }
  .sheet h4{ margin:0 0 10px; font-size:16px; font-weight:800 }
  .sheet .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }

  /* Pensando (4s) */
  .thinking{
    margin-top:14px; padding:12px 14px; border:1px dashed var(--border);
    border-radius:var(--radius); color:var(--muted); display:flex; align-items:center; gap:10px; background:#fff;
  }
  .dot{ width:6px; height:6px; border-radius:50%; background:#3c4043; opacity:.35; animation:blink 1.2s infinite ease-in-out }
  .dot:nth-child(2){ animation-delay:.2s } .dot:nth-child(3){ animation-delay:.4s }
  @keyframes blink{ 0%,80%,100%{ opacity:.2 } 40%{ opacity:1 } }
</style>
</head>
<body>
  <header class="top">
    <div class="brand">direito.love</div>
    <div class="right-icons">
      <a href="https://www.instagram.com/osvaldosereiajr/" target="_blank" rel="noopener" title="Instagram" aria-label="Instagram">
        <i class="icon" aria-hidden="true"></i>
      </a>
    </div>
  </header>

  <main class="wrap">
    <nav class="tabs" role="tablist" aria-label="Navega√ß√£o">
      <button class="tab" id="tab-inicio" aria-controls="panel-inicio" aria-selected="true">In√≠cio</button>
      <button class="tab" id="tab-arquivo" aria-controls="panel-arquivo" aria-selected="false">Arquivo</button>
    </nav>

    <section id="panel-inicio" class="card" role="tabpanel" aria-labelledby="tab-inicio">
      <h1 class="title">Sobre o que vamos falar?</h1>

      <!-- Campo + bot√£o em coluna -->
      <div class="stack" id="step1">
        <input id="tema" class="field" type="text" placeholder="Ex.: Dano moral e dano est√©tico na OAB" aria-label="Tema" />
        <button id="avancar" class="btn btn-primary">Come√ßar a M√°gica</button>
      </div>

      <div id="thinking" class="thinking hidden" aria-live="polite">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        <span>pensando‚Ä¶ preparando seus prompts</span>
      </div>

      <!-- Step 2: aparece ap√≥s 4s -->
      <div id="step2" class="hidden" hidden style="margin-top:18px">
        <h1 class="title" style="margin-top:0">Escolha sua IA</h1>
        <div class="chips" id="chips-ias"></div>
      </div>

      <div class="divider"></div>
    </section>

    <section id="panel-arquivo" class="card" role="tabpanel" aria-labelledby="tab-arquivo" hidden>
      <h2 class="title" style="font-size:18px">Arquivo ‚Äî prompts copiados</h2>
      <div id="book-grouped" style="font-size:14px"></div>
    </section>
  </main>

  <!-- Banner de instalar app (fica acima da barra flutuante) -->
  <div id="install-banner" class="install-banner">
    <p>üì≤ Instale o app do direito.love</p>
    <div class="install-actions">
      <button id="install-btn" class="btn btn-primary btn-small" disabled>Instalar app</button>
      <button id="install-close" class="btn btn-ghost btn-small">Fechar</button>
    </div>
  </div>

  <!-- Barra flutuante: Abrir IA + Nova pesquisa -->
  <div class="floatbar" aria-label="A√ß√µes r√°pidas">
    <div class="inner">
      <a id="open-ia" class="btn btn-ghost btn-disabled" href="#" target="_blank" rel="noopener" aria-disabled="true">Abrir IA</a>
      <button id="reset" class="btn btn-primary">Nova pesquisa</button>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Copiado!</div>

  <!-- Janela central (mantida) -->
  <div id="sheet" class="sheet" aria-modal="true" role="dialog" aria-labelledby="sheet-title">
    <div class="box">
      <h4 id="sheet-title">Prompt Copiado</h4>
      <div class="actions">
        <a id="open-ia-modal" class="btn btn-primary" href="#" target="_blank" rel="noopener">Abrir IA</a>
        <button id="sheet-close" class="btn btn-ghost">Fechar</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){

  /* ===== Tabs ===== */
  const tabInicio=document.getElementById('tab-inicio'), tabArq=document.getElementById('tab-arquivo');
  const panelInicio=document.getElementById('panel-inicio'), panelArq=document.getElementById('panel-arquivo');

  function selectTab(which){
    const ini=which==='inicio';
    tabInicio.setAttribute('aria-selected',ini);
    tabArq.setAttribute('aria-selected',!ini);
    panelInicio.hidden=!ini; panelArq.hidden=ini;
  }
  tabInicio.addEventListener('click',()=>selectTab('inicio'));
  tabArq.addEventListener('click',()=>{ renderBookGrouped(); selectTab('arquivo'); });

  /* ===== State/refs ===== */
  let current={ tema:"", lastIA:null };
  const el={
    tema:document.getElementById('tema'),
    avancar:document.getElementById('avancar'),
    thinking:document.getElementById('thinking'),
    step2:document.getElementById('step2'),
    chipsIAs:document.getElementById('chips-ias'),
    toast:document.getElementById('toast'),
    openIA:document.getElementById('open-ia'),
    sheet:document.getElementById('sheet'),
    sheetClose:document.getElementById('sheet-close'),
    openIAModal:document.getElementById('open-ia-modal'),
    bookGrouped:document.getElementById('book-grouped'),
    reset:document.getElementById('reset'),
    installBanner:document.getElementById('install-banner'),
    installBtn:document.getElementById('install-btn'),
    installClose:document.getElementById('install-close'),
  };

  /* ===== Storage ===== */
  const BOOK_KEY='book_data_v27';
  function load(k,fb){ try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(fb));}catch{return fb} }
  function save(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  function pushEntry(e){ let d=load(BOOK_KEY,[]); d.unshift(e); if(d.length>300) d=d.slice(0,300); save(BOOK_KEY,d); }

  /* ===== IA Links ===== */
  const IA_LINKS={ 'ChatGPT':'https://chatgpt.com/', 'Gemini':'https://gemini.google.com/', 'Perplexity':'https://www.perplexity.ai/' };

  /* ===== Flow: Come√ßar a M√°gica -> 4s -> 3 IAs ===== */
  el.avancar.addEventListener('click', ()=>{
    const tema=(el.tema.value||'').trim();
    if(!tema){ alert('Digite o tema.'); el.tema.focus(); return; }
    if(tema.length<3){ alert('Tema muito curto.'); el.tema.focus(); return; }
    current.tema=tema;

    el.avancar.classList.add('btn-disabled'); el.avancar.setAttribute('aria-disabled','true');
    el.thinking.classList.remove('hidden');

    setTimeout(()=>{
      el.thinking.classList.add('hidden');
      renderIAChips();
      el.step2.classList.remove('hidden'); el.step2.removeAttribute('hidden');
      window.scrollTo({ top: el.step2.offsetTop-8, behavior:'smooth' });
      el.avancar.classList.remove('btn-disabled'); el.avancar.removeAttribute('aria-disabled');
    }, 4000);
  });

  function renderIAChips(){
    el.chipsIAs.innerHTML='';
    ['ChatGPT','Gemini','Perplexity'].forEach(ia=>{
      const b=document.createElement('button');
      b.className='chip'; b.textContent=ia; b.title='Copiar prompt para '+ia;
      b.addEventListener('click', ()=>onIA(ia));
      el.chipsIAs.appendChild(b);
    });
  }

  /* ===== Prompts 3-em-1 (foco prova/OAB/concurso) ===== */
  function footer(){ return '**üíö [direito.love](https://direito.love)**\\nGere um novo prompt em [direito.love](https://direito.love)'; }

  function promptGPT(t){
    return (
`Voc√™ √© um **professor de Direito especializado em prepara√ß√£o para provas, OAB e concursos**, escolhido pelo projeto **direito.love**. Sua miss√£o √© conduzir o aluno por uma jornada completa sobre:

**TEMA:**  
**${t}**

A jornada ter√° **3 etapas sequenciais**:
1. Explica√ß√£o did√°tica (APRENDER)  
2. Simulado com gabarito (TREINAR)  
3. Dicas de prova e pegadinhas (DESCOBRIR)

‚ö†Ô∏è Ao final de **cada etapa**, pare e pergunte:  
‚û°Ô∏è ‚ÄúQuer continuar?‚Äù

---

# üìò ETAPA 1 ‚Äî APRENDER
- Explique o conceito em at√© 6 linhas, focando no que cai na OAB/concursos.  
- D√™ 1‚Äì2 exemplos t√≠picos de prova.  
- Traga o entendimento consolidado do STJ/STF (sem n√∫meros de processo).  
- Liste 2‚Äì3 pegadinhas cl√°ssicas.

üëâ Encerrando a etapa:  
‚û°Ô∏è *‚ÄúQuer continuar para a etapa de treino?‚Äù*

---

# üìù ETAPA 2 ‚Äî TREINAR
- Monte **5 quest√µes objetivas** (4 alternativas, 1 correta).  
- Linguagem de banca.  
- **Gabarito comentado no final.**

üëâ Encerrando a etapa:  
‚û°Ô∏è *‚ÄúQuer ver agora 10 dicas pr√°ticas pra acertar mais quest√µes?‚Äù*

---

# üîé ETAPA 3 ‚Äî DESCOBRIR
- Liste **10 dicas de prova**: diferen√ßas sutis, confus√µes frequentes, palavras-chave e pegadinhas.

${footer()}`
    );
  }

  function promptGemini(t){
    return (
`Voc√™ √© um **professor jur√≠dico experiente**, do projeto **direito.love**, e vai ensinar **${t}** em 3 etapas distintas para **provas, OAB e concursos**.

‚ö†Ô∏è Regras de fluxo:
- Responda **somente a etapa atual**.
- Ao final de cada etapa, **pergunte se o aluno quer continuar** e **aguarde a resposta**.

---

## üìò ETAPA 1 ‚Äî APRENDER
- Conceito em at√© 6 linhas (linguagem clara).  
- Exemplo objetivo estilo OAB.  
- Posi√ß√£o dominante do STJ/STF (sem REsp/AREsp/n¬∫).  
- 2 pegadinhas comuns de prova.

üëâ Final da etapa. Aguarde com:  
‚û°Ô∏è *‚ÄúDeseja continuar para a pr√≥xima etapa (treinar)?‚Äù*

---

## üìù ETAPA 2 ‚Äî TREINAR
- 5 quest√µes (4 alternativas, 1 correta), estilo banca.  
- Ao final, **gabarito com coment√°rios curtos**.

üëâ Final da etapa. Aguarde com:  
‚û°Ô∏è *‚ÄúVamos para 10 dicas pr√°ticas de prova?‚Äù*

---

## üîé ETAPA 3 ‚Äî DESCOBRIR
- 10 dicas √∫teis para acertar quest√µes (diferen√ßas conceituais, confus√µes recorrentes, termos de enunciado, erros cl√°ssicos).

${footer()}`
    );
  }

  function promptPerplexity(t){
    return (
`Voc√™ √© um professor de Direito para preparar alunos para **OAB e concursos**.

TEMA: **${t}**

Responda por etapas.  
‚ö†Ô∏è Ao final de cada etapa, pergunte se deseja continuar.  
N√£o junte as 3 respostas de uma vez.

---

### üìò ETAPA 1 ‚Äî APRENDER
- Conceito claro (at√© 6 linhas)  
- Exemplo objetivo  
- Entendimento atual do STJ/STF (sem REsp/AREsp)  
- Pegadinhas comuns

‚ùì *Quer passar para a pr√≥xima etapa (treinar)?*

---

### üìù ETAPA 2 ‚Äî TREINAR
- 5 quest√µes de m√∫ltipla escolha, estilo banca  
- Gabarito no final **com justificativas curtas**

‚ùì *Vamos para a √∫ltima etapa (10 dicas de prova)?*

---

### üîé ETAPA 3 ‚Äî DESCOBRIR
- 10 dicas para acertar quest√µes (erros comuns, confus√µes, atalhos de memoriza√ß√£o).  
- Seja direto: foco em **acertar a prova**.

${footer()}`
    );
  }

  function buildPrompt(ia, tema){
    if(ia==='ChatGPT') return promptGPT(tema);
    if(ia==='Gemini') return promptGemini(tema);
    if(ia==='Perplexity') return promptPerplexity(tema);
    return '';
  }

  async function onIA(ia){
    try{
      const prompt = buildPrompt(ia, current.tema);
      await navigator.clipboard.writeText(String(prompt||''));
      pushEntry({ objetivo:'3-em-1', ia, tema: current.tema, prompt, ts: Date.now() });
      toast('Copiado!');
      current.lastIA = ia;
      enableOpenIA(ia);
      updateModalIA(ia);
      openSheet();
    }catch{ alert('N√£o foi poss√≠vel copiar.'); }
  }

  function toast(msg='Copiado!'){
    const t=document.getElementById('toast');
    t.textContent=msg; t.style.display='block';
    setTimeout(()=> t.style.display='none', 1100);
  }

  function enableOpenIA(ia){
    const a=IA_LINKS[ia];
    if(a){
      el.openIA.textContent = 'Abrir IA: '+ia;
      el.openIA.href = a;
      el.openIA.classList.remove('btn-disabled');
      el.openIA.setAttribute('aria-disabled','false');
    } else {
      el.openIA.textContent = 'Abrir IA';
      el.openIA.removeAttribute('href');
      el.openIA.classList.add('btn-disabled');
      el.openIA.setAttribute('aria-disabled','true');
    }
  }

  function openSheet(){ el.sheet.style.display='grid'; }
  function closeSheet(){ el.sheet.style.display='none'; }
  document.getElementById('sheet-close').addEventListener('click', closeSheet);
  el.sheet.addEventListener('click', (e)=>{ if(e.target===el.sheet) closeSheet(); });
  function updateModalIA(ia){ const url = IA_LINKS[ia] || '#'; el.openIAModal.textContent = 'Abrir '+ia; el.openIAModal.href = url; }

  /* ===== Reset corrigido ===== */
  el.reset.addEventListener('click', ()=>{
    // volta para In√≠cio
    selectTab('inicio');
    // zera estado
    current = { tema:"", lastIA:null };
    // limpa UI
    el.tema.value='';
    el.step2.classList.add('hidden'); el.step2.setAttribute('hidden','');
    el.chipsIAs.innerHTML='';
    el.thinking.classList.add('hidden');
    enableOpenIA(null);
    closeSheet();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  /* ===== Arquivo render ===== */
  function renderBookGrouped(){
    const data = load(BOOK_KEY, []);
    const box = el.bookGrouped;
    if(!data.length){ box.innerHTML='<div style="color:var(--muted)">Arquivo vazio.</div>'; return; }
    const groups={};
    for(const it of data){ const k=(it.objetivo||'‚Äî').toUpperCase(); (groups[k]=groups[k]||[]).push(it); }
    box.innerHTML='';
    Object.keys(groups).forEach(k=>{
      const c=document.createElement('div'); c.className='card'; c.style.marginBottom='12px';
      c.innerHTML='<h4 style="margin:0 0 8px; font-weight:800">'+k+'</h4>';
      groups[k].forEach(it=>{
        const row=document.createElement('div');
        row.style.cssText='display:flex;justify-content:space-between;gap:8px;border:1px solid var(--border);border-radius:12px;padding:10px;margin-bottom:8px;background:#fff';
        row.innerHTML='<div><b style="font-weight:800">'+it.ia+'</b> ‚Ä¢ '+it.tema+'<br><span style="color:var(--muted)">'+new Date(it.ts).toLocaleString()+'</span></div><div style="display:flex;gap:8px"><button class="btn btn-ghost btn-small" data-copy>Copiar</button></div>';
        row.querySelector('[data-copy]').addEventListener('click', async ()=>{
          try{
            await navigator.clipboard.writeText(String(it.prompt||'')); toast('Copiado!');
            if (it.ia && IA_LINKS[it.ia]) enableOpenIA(it.ia);
          }catch{ alert('N√£o foi poss√≠vel copiar.'); }
        });
        c.appendChild(row);
      });
      box.appendChild(c);
    });
  }

  /* ===== PWA: Service Worker ===== */
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }

  /* ===== PWA: Install banner fixado no in√≠cio ===== */
  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', (e)=>{
    e.preventDefault();
    deferredPrompt = e;
    // habilita bot√£o instalar
    el.installBtn.disabled = false;
  });

  el.installBtn.addEventListener('click', async ()=>{
    if(!deferredPrompt){
      toast('Aguarde‚Ä¶ preparando instala√ß√£o');
      return;
    }
    try{
      el.installBtn.classList.add('btn-disabled');
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      toast(choice.outcome==='accepted'?'Instala√ß√£o iniciada':'Instala√ß√£o cancelada');
      deferredPrompt = null;
      // some com o banner ap√≥s tentativa
      el.installBanner.style.display='none';
    }catch{
      el.installBtn.classList.remove('btn-disabled');
    }
  });
  el.installClose.addEventListener('click', ()=> el.installBanner.style.display='none');

  window.addEventListener('appinstalled', ()=>{
    toast('App instalado!');
    el.installBanner.style.display='none';
  });

  /* ===== Util ===== */
  function selectTab(which){
    const ini=which==='inicio';
    tabInicio.setAttribute('aria-selected',ini);
    tabArq.setAttribute('aria-selected',!ini);
    panelInicio.hidden=!ini; panelArq.hidden=ini;
  }

  // Chips handler global (delegation alternative)
  function onIA(ia){ /* definido acima via addEventListener */ }

  // Exibe IA chips se voltar de arquivo e j√° houver tema digitado
  // (opcional, mantido simples)
});
</script>
</body>
</html>
