<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>direito.love — Estudo 3-em-1</title>
<meta name="theme-color" content="#343541" />
<link rel="manifest" href="./manifest.json">

<style>
  /* ===== ChatGPT-like Theme ===== */
  :root{
    --bg:#343541; --panel:#444654; --input:#40414f;
    --text:#ececf1; --muted:#acb1c3; --border:#565869;
    --accent:#10a37f; --shadow:0 8px 24px rgba(0,0,0,.35); --radius:10px;
  }
  *{ box-sizing:border-box } html,body{ height:100% }
  body{ margin:0; background:var(--bg); color:var(--text);
        font:400 16px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }

  .top{ position:sticky; top:0; z-index:10; background:linear-gradient(180deg,#353641,#2f3140);
        border-bottom:1px solid var(--border); padding:10px 16px; display:flex; align-items:center; justify-content:space-between; }
  .brand{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px }
  .brand img{ height:28px; width:auto }
  .right-icons a img{ height:22px; width:22px; opacity:.9 }

  .wrap{ max-width:900px; margin:0 auto; padding:22px 16px 140px }
  .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; }
  .title{ margin:0 0 14px; font-size:20px; font-weight:700 }

  .tabs{ display:flex; gap:8px; margin:10px 0 18px }
  .tab{ all:unset; cursor:pointer; letter-spacing:.2px; padding:10px 14px; border-radius:999px; color:var(--text); border:1px solid var(--border); font-weight:700; background:transparent }
  .tab[aria-selected="true"]{ background:#3a3c4b }

  .row{ display:grid; gap:10px; grid-template-columns:1fr auto; align-items:center }
  .field{ background:var(--input); color:var(--text); border:1px solid var(--border); outline:none; padding:12px 14px; border-radius:var(--radius); font-weight:500 }
  .field::placeholder{ color:#cfd3df88 } .field:focus{ border-color:#8e909b }

  .btn{ all:unset; cursor:pointer; user-select:none; padding:12px 16px; border-radius:var(--radius);
        display:inline-flex; align-items:center; justify-content:center; gap:8px; font-weight:600; transition:transform .08s ease, opacity .2s ease; }
  .btn:active{ transform:translateY(1px) }
  .btn-primary{ background:var(--accent); color:#0c0c0d }
  .btn-ghost{ background:transparent; color:var(--text); border:1px solid var(--border) }
  .btn-small{ padding:8px 10px; font-size:12px; border-radius:8px }
  .btn-disabled{ opacity:.5; pointer-events:none }

  .chips{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
  .chip{ all:unset; padding:10px 14px; border-radius:999px; cursor:pointer; background:transparent; color:var(--text); border:1px solid var(--border); font-weight:600 }
  .chip:hover{ background:#3a3c4b }

  .divider{ height:1px; background:var(--border); margin:18px 0 }
  .hidden{ display:none !important; }

  .floatbar{ position:fixed; left:16px; right:16px; bottom:16px; z-index:50; display:flex; justify-content:flex-end; pointer-events:none }
  .floatbar .inner{ pointer-events:auto; display:flex; gap:8px; padding:10px;
    background:#2f3140e8; border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); }

  .toast{ position:fixed; z-index:60; right:16px; bottom:84px; background:var(--accent); color:#0b0c0d;
    padding:10px 14px; border-radius:10px; display:none; font-weight:800 }

  .sheet{ position:fixed; inset:0; display:none; place-items:center; z-index:80; background:rgba(0,0,0,.55); backdrop-filter:blur(2px) }
  .sheet .box{ width:min(560px,92vw); background:#2f3140; color:var(--text); border:1px solid var(--border);
    border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; text-align:center; }
  .sheet h4{ margin:0 0 10px; font-size:16px; font-weight:700 }
  .sheet .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px }

  .thinking{ margin-top:14px; padding:12px 14px; border:1px dashed var(--border); border-radius:var(--radius); color:var(--muted); display:flex; align-items:center; gap:10px; }
  .dot{ width:6px; height:6px; border-radius:50%; background:#cfd3df; opacity:.6; animation:blink 1.2s infinite ease-in-out }
  .dot:nth-child(2){ animation-delay:.2s } .dot:nth-child(3){ animation-delay:.4s }
  @keyframes blink{ 0%,80%,100%{ opacity:.2 } 40%{ opacity:1 } }
</style>
</head>
<body>
  <header class="top">
    <div class="brand"><img src="./icons/logo-heart.png" alt="direito.love" /> <span>direito.love</span></div>
    <div class="right-icons">
      <a href="https://www.instagram.com/osvaldosereiajr/" target="_blank" rel="noopener" title="Instagram">
        <img src="./icons/instagram.png" alt="Instagram">
      </a>
    </div>
  </header>

  <main class="wrap">
    <nav class="tabs" role="tablist" aria-label="Navegação">
      <button class="tab" id="tab-inicio" aria-controls="panel-inicio" aria-selected="true">Início</button>
      <button class="tab" id="tab-arquivo" aria-controls="panel-arquivo" aria-selected="false">Arquivo</button>
    </nav>

    <section id="panel-inicio" class="card" role="tabpanel" aria-labelledby="tab-inicio">
      <h1 class="title">Sobre o que vamos falar?</h1>

      <div class="row" id="step1">
        <input id="tema" class="field" type="text" placeholder="Ex.: Dano moral e dano estético na OAB" aria-label="Tema" />
        <button id="avancar" class="btn btn-primary">Começar a Mágica</button>
      </div>

      <div id="thinking" class="thinking hidden" aria-live="polite">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        <span>pensando… preparando seus prompts</span>
      </div>

      <div id="step2" class="hidden" hidden style="margin-top:18px">
        <h1 class="title" style="margin-top:0">Escolha sua IA</h1>
        <div class="chips" id="chips-ias"></div>
      </div>

      <div class="divider"></div>
    </section>

    <section id="panel-arquivo" class="card" role="tabpanel" aria-labelledby="tab-arquivo" hidden>
      <h2 class="title" style="font-size:18px">Arquivo — prompts copiados</h2>
      <div id="book-grouped" style="font-size:14px"></div>
    </section>
  </main>

  <div class="floatbar" aria-label="Ações rápidas">
    <div class="inner">
      <a id="open-ia" class="btn btn-ghost btn-disabled" href="#" target="_blank" rel="noopener" aria-disabled="true">Abrir IA</a>
      <button id="reset" class="btn btn-primary">Nova pesquisa</button>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite">Copiado!</div>

  <div id="sheet" class="sheet" aria-modal="true" role="dialog" aria-labelledby="sheet-title">
    <div class="box">
      <h4 id="sheet-title">Prompt Copiado</h4>
      <div class="actions">
        <a id="open-ia-modal" class="btn btn-primary" href="#" target="_blank" rel="noopener">Abrir IA</a>
        <button id="sheet-close" class="btn btn-ghost">Fechar</button>
      </div>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  /* ===== Tabs ===== */
  const tabInicio=document.getElementById('tab-inicio'), tabArq=document.getElementById('tab-arquivo');
  const panelInicio=document.getElementById('panel-inicio'), panelArq=document.getElementById('panel-arquivo');
  const resetBtn=document.getElementById('reset');

  function selectTab(which){
    const ini=which==='inicio';
    tabInicio.setAttribute('aria-selected',ini);
    tabArq.setAttribute('aria-selected',!ini);
    panelInicio.hidden=!ini; panelArq.hidden=ini;
    if(!ini){
      renderBookGrouped();
      resetBtn.classList.add('btn-disabled'); resetBtn.setAttribute('aria-disabled','true'); resetBtn.style.pointerEvents='none';
    } else {
      resetBtn.classList.remove('btn-disabled'); resetBtn.removeAttribute('aria-disabled'); resetBtn.style.pointerEvents='auto';
    }
  }
  tabInicio.addEventListener('click',()=>selectTab('inicio'));
  tabArq.addEventListener('click',()=>selectTab('arquivo'));

  /* ===== State ===== */
  let current={ tema:"", lastIA:null };
  const el={
    tema:document.getElementById('tema'),
    avancar:document.getElementById('avancar'),
    thinking:document.getElementById('thinking'),
    step2:document.getElementById('step2'),
    chipsIAs:document.getElementById('chips-ias'),
    toast:document.getElementById('toast'),
    openIA:document.getElementById('open-ia'),
    sheet:document.getElementById('sheet'),
    sheetClose:document.getElementById('sheet-close'),
    openIAModal:document.getElementById('open-ia-modal'),
    bookGrouped:document.getElementById('book-grouped'),
  };

  /* ===== Storage ===== */
  const BOOK_KEY='book_data_v26';
  function load(k,fb){ try{return JSON.parse(localStorage.getItem(k)||JSON.stringify(fb));}catch{return fb} }
  function save(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  function pushEntry(e){ let d=load(BOOK_KEY,[]); d.unshift(e); if(d.length>300) d=d.slice(0,300); save(BOOK_KEY,d); }

  /* ===== IA Links ===== */
  const IA_LINKS={ 'ChatGPT':'https://chatgpt.com/', 'Gemini':'https://gemini.google.com/', 'Perplexity':'https://www.perplexity.ai/' };

  /* ===== Flow: Começar a Mágica -> 4s -> 3 IAs ===== */
  el.avancar.addEventListener('click', ()=>{
    const tema=(el.tema.value||'').trim();
    if(!tema){ alert('Digite o tema.'); el.tema.focus(); return; }
    if(tema.length<3){ alert('Tema muito curto.'); el.tema.focus(); return; }
    current.tema=tema;

    el.avancar.classList.add('btn-disabled'); el.avancar.setAttribute('aria-disabled','true');
    el.thinking.classList.remove('hidden');

    setTimeout(()=>{
      el.thinking.classList.add('hidden');
      renderIAChips();
      el.step2.classList.remove('hidden'); el.step2.removeAttribute('hidden');
      window.scrollTo({ top: el.step2.offsetTop-8, behavior:'smooth' });
      el.avancar.classList.remove('btn-disabled'); el.avancar.removeAttribute('aria-disabled');
    }, 4000);
  });

  function renderIAChips(){
    el.chipsIAs.innerHTML='';
    ['ChatGPT','Gemini','Perplexity'].forEach(ia=>{
      const b=document.createElement('button');
      b.className='chip'; b.textContent=ia; b.title='Copiar prompt para '+ia;
      b.addEventListener('click', ()=>onIA(ia));
      el.chipsIAs.appendChild(b);
    });
  }

  /* ===== Prompts 3-em-1 (foco prova/OAB/concurso) ===== */
  function footer(){ return '**💚 [direito.love](https://direito.love)**\nGere um novo prompt em [direito.love](https://direito.love)'; }

  function promptGPT(t){
    return (
`Você é um **professor de Direito especializado em preparação para provas, OAB e concursos**, escolhido pelo projeto **direito.love**. Sua missão é conduzir o aluno por uma jornada completa sobre:

**TEMA:**  
**${t}**

A jornada terá **3 etapas sequenciais**:
1. Explicação didática (APRENDER)  
2. Simulado com gabarito (TREINAR)  
3. Dicas de prova e pegadinhas (DESCOBRIR)

⚠️ Ao final de **cada etapa**, pare e pergunte:  
➡️ “Quer continuar?”

---

# 📘 ETAPA 1 — APRENDER
- Explique o conceito em até 6 linhas, focando no que cai na OAB/concursos.  
- Dê 1–2 exemplos típicos de prova.  
- Traga o entendimento consolidado do STJ/STF (sem números de processo).  
- Liste 2–3 pegadinhas clássicas.

👉 Encerrando a etapa:  
➡️ *“Quer continuar para a etapa de treino?”*

---

# 📝 ETAPA 2 — TREINAR
- Monte **5 questões objetivas** (4 alternativas, 1 correta).  
- Linguagem de banca.  
- **Gabarito comentado no final.**

👉 Encerrando a etapa:  
➡️ *“Quer ver agora 10 dicas práticas pra acertar mais questões?”*

---

# 🔎 ETAPA 3 — DESCOBRIR
- Liste **10 dicas de prova**: diferenças sutis, confusões frequentes, palavras-chave e pegadinhas.

${footer()}`
    );
  }

  function promptGemini(t){
    return (
`Você é um **professor jurídico experiente**, do projeto **direito.love**, e vai ensinar **${t}** em 3 etapas distintas para **provas, OAB e concursos**.

⚠️ Regras de fluxo:
- Responda **somente a etapa atual**.
- Ao final de cada etapa, **pergunte se o aluno quer continuar** e **aguarde a resposta**.

---

## 📘 ETAPA 1 — APRENDER
- Conceito em até 6 linhas (linguagem clara).  
- Exemplo objetivo estilo OAB.  
- Posição dominante do STJ/STF (sem REsp/AREsp/nº).  
- 2 pegadinhas comuns de prova.

👉 Final da etapa. Aguarde com:  
➡️ *“Deseja continuar para a próxima etapa (treinar)?”*

---

## 📝 ETAPA 2 — TREINAR
- 5 questões (4 alternativas, 1 correta), estilo banca.  
- Ao final, **gabarito com comentários curtos**.

👉 Final da etapa. Aguarde com:  
➡️ *“Vamos para 10 dicas práticas de prova?”*

---

## 🔎 ETAPA 3 — DESCOBRIR
- 10 dicas úteis para acertar questões (diferenças conceituais, confusões recorrentes, termos de enunciado, erros clássicos).

${footer()}`
    );
  }

  function promptPerplexity(t){
    return (
`Você é um professor de Direito para preparar alunos para **OAB e concursos**.

TEMA: **${t}**

Responda por etapas.  
⚠️ Ao final de cada etapa, pergunte se deseja continuar.  
Não junte as 3 respostas de uma vez.

---

### 📘 ETAPA 1 — APRENDER
- Conceito claro (até 6 linhas)  
- Exemplo objetivo  
- Entendimento atual do STJ/STF (sem REsp/AREsp)  
- Pegadinhas comuns

❓ *Quer passar para a próxima etapa (treinar)?*

---

### 📝 ETAPA 2 — TREINAR
- 5 questões de múltipla escolha, estilo banca  
- Gabarito no final **com justificativas curtas**

❓ *Vamos para a última etapa (10 dicas de prova)?*

---

### 🔎 ETAPA 3 — DESCOBRIR
- 10 dicas para acertar questões (erros comuns, confusões, atalhos de memorização).  
- Seja direto: foco em **acertar a prova**.

${footer()}`
    );
  }

  function buildPrompt(ia, tema){
    if(ia==='ChatGPT') return promptGPT(tema);
    if(ia==='Gemini') return promptGemini(tema);
    if(ia==='Perplexity') return promptPerplexity(tema);
    return '';
  }

  async function onIA(ia){
    try{
      const prompt = buildPrompt(ia, current.tema);
      await navigator.clipboard.writeText(String(prompt||''));
      pushEntry({ objetivo:'3-em-1', ia, tema: current.tema, prompt, ts: Date.now() });
      toast('Copiado!');
      current.lastIA = ia;
      enableOpenIA(ia);
      updateModalIA(ia);
      openSheet();
    }catch{ alert('Não foi possível copiar.'); }
  }

  function toast(msg='Copiado!'){
    const t=document.getElementById('toast');
    t.textContent=msg; t.style.display='block';
    setTimeout(()=> t.style.display='none', 1000);
  }

  function enableOpenIA(ia){
    const a=IA_LINKS[ia];
    if(a){
      el.openIA.textContent = 'Abrir IA: '+ia;
      el.openIA.href = a;
      el.openIA.classList.remove('btn-disabled');
      el.openIA.setAttribute('aria-disabled','false');
    } else {
      el.openIA.textContent = 'Abrir IA';
      el.openIA.removeAttribute('href');
      el.openIA.classList.add('btn-disabled');
      el.openIA.setAttribute('aria-disabled','true');
    }
  }

  function openSheet(){ el.sheet.style.display='grid'; }
  function closeSheet(){ el.sheet.style.display='none'; }
  function updateModalIA(ia){ const url = IA_LINKS[ia] || '#'; el.openIAModal.textContent = 'Abrir '+ia; el.openIAModal.href = url; }
  document.getElementById('sheet-close').addEventListener('click', closeSheet);
  el.sheet.addEventListener('click', (e)=>{ if(e.target===el.sheet) closeSheet(); });

  /* ===== Arquivo render ===== */
  function renderBookGrouped(){
    const data = load(BOOK_KEY, []);
    const box = document.getElementById('book-grouped');
    if(!data.length){ box.innerHTML='<div style="color:var(--muted)">Arquivo vazio.</div>'; return; }
    const groups={};
    for(const it of data){ const k=(it.objetivo||'—').toUpperCase(); (groups[k]=groups[k]||[]).push(it); }
    box.innerHTML='';
    Object.keys(groups).forEach(k=>{
      const c=document.createElement('div'); c.className='card'; c.style.marginBottom='12px';
      c.innerHTML='<h4 style="margin:0 0 8px; font-weight:700">'+k+'</h4>';
      groups[k].forEach(it=>{
        const row=document.createElement('div');
        row.style.cssText='display:flex;justify-content:space-between;gap:8px;border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:8px;background:#3a3c4b';
        row.innerHTML='<div><b style="font-weight:700">'+it.ia+'</b> • '+it.tema+'<br><span style="color:var(--muted)">'+new Date(it.ts).toLocaleString()+'</span></div><div style="display:flex;gap:8px"><button class="btn btn-ghost btn-small" data-copy>Copiar</button></div>';
        row.querySelector('[data-copy]').addEventListener('click', async ()=>{
          try{
            await navigator.clipboard.writeText(String(it.prompt||'')); toast('Copiado!');
            if (it.ia && IA_LINKS[it.ia]) enableOpenIA(it.ia);
          }catch{ alert('Não foi possível copiar.'); }
        });
        c.appendChild(row);
      });
      box.appendChild(c);
    });
  }

  /* ===== PWA: Service Worker ===== */
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js').catch(()=>{}));
  }

  /* ===== PWA: Install banner (2 usos + 10s) ===== */
  (function(){
    const floatbar = document.querySelector('.floatbar .inner');
    const installBtn = document.createElement('button');
    installBtn.id='install-btn';
    installBtn.className='btn btn-ghost';
    installBtn.textContent='Instalar app';
    installBtn.style.display='none';
    floatbar.prepend(installBtn);

    let deferredPrompt=null;
    let usageCount = Number(localStorage.getItem('dl_usage')||'0');

    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      maybeShowInstall();
    });

    function maybeShowInstall(){
      if(!deferredPrompt) return;
      if(usageCount < 2) return;
      setTimeout(()=>{ installBtn.style.display='inline-flex'; }, 10000);
    }

    try{
      if(!sessionStorage.getItem('dl_seen')){
        sessionStorage.setItem('dl_seen','1');
        localStorage.setItem('dl_usage', String(usageCount+1));
        usageCount++;
      }
    }catch{}

    installBtn.addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      installBtn.disabled = true;
      try{
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        toast(outcome === 'accepted' ? 'Instalação iniciada' : 'Instalação cancelada');
        deferredPrompt = null;
        installBtn.style.display='none';
      }catch{ installBtn.disabled=false; }
    });

    window.addEventListener('appinstalled', ()=>{
      toast('App instalado!');
      installBtn.style.display='none';
    });

    function toast(msg='Copiado!'){
      const t=document.getElementById('toast');
      if(!t) return; t.textContent=msg; t.style.display='block';
      setTimeout(()=> t.style.display='none', 1000);
    }

    setTimeout(maybeShowInstall, 1000);
  })();
});
</script>
</body>
</html>
