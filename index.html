<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>direito.love — Criador de Prompts</title>
  <meta name="theme-color" content="#F5C400" />
  <meta name="description" content="Crie prompts jurídicos claros e completos por categorias." />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon-180.png" />
  <style>
    :root{
      --bg:#FFFDF0; --surface:#ffffff; --text:#001840; --border:#e5e7eb;
      --primary:#102A71; --highlight:#F5C400; --highlight-light:#FFDC5F;
      --radius:12px; --shadow:0 4px 16px rgba(0,0,0,.05);
      --font:-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",Roboto,system-ui,sans-serif;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --bar-h: 56px;
      --success:#16a34a; --muted-btn:#e5e7eb;
      --snap-offset: 96px;

      /* Mesmo padrão de botões da pesquisa */
      --btn-pad-y: 6px;
      --btn-pad-x: 10px;
      --btn-font: 12.5px;
      --btn-min-h: 34px;
      --btn-min-w: 96px;

      --chip-pad-y: 6px;
      --chip-pad-x: 10px;
      --chip-font: 12.5px;
      --chip-radius: 8px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:400 13px/1.45 var(--font);}

    /* Topbar (igual pesquisa) */
    .topbar{position:sticky; top:0; z-index:100; background:var(--highlight); border-bottom:1px solid rgba(0,0,0,.08)}
    .topbar__inner{max-width:1160px; margin:0 auto; padding:8px 12px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#111}
    .brand__logo{height:32px}
    .chip{
      padding:var(--chip-pad-y) var(--chip-pad-x);
      border-radius:var(--chip-radius);
      background:#fff; border:1px solid var(--border);
      font-size:var(--chip-font); color:var(--primary); text-decoration:none; font-weight:600; transition:.15s
    }
    .chip:hover{background:var(--highlight-light)}

    .wrap{max-width:900px;margin:0 auto;padding:22px; transition:padding-bottom .2s ease;}
    h2{margin:0 0 10px;color:var(--primary)}

    /* Aviso acima do tema (mostrado quando vem da pesquisa) */
    .notice{
      display:none; margin-top:10px; margin-bottom:6px;
      background:#fff7d6; border:1px solid #f3dd94; color:#5b4400;
      padding:8px 12px; border-radius:10px; font-weight:600;
    }
    .notice.show{ display:block; }

    /* Tema */
    .tema-wrap{display:grid; gap:10px; margin:12px 0 10px}
    #tema{width:100%; min-height:100px; resize:vertical; padding:10px 12px; border:2px solid var(--primary); border-radius:10px; font-size:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn, .btn-alt, .btn-ghost{
      padding:var(--btn-pad-y) var(--btn-pad-x); border-radius:8px; font-size:var(--btn-font);
      min-height:var(--btn-min-h); min-width:var(--btn-min-w); cursor:pointer; transition:.15s;
    }
    .btn{appearance:none;border:1px solid var(--border);background:var(--highlight);color:#000;}
    .btn:hover{background:var(--highlight-light)}
    .btn-alt{appearance:none;border:1px solid #0f2a71;background:var(--primary);color:#fff;}
    .btn-alt:hover{background:#264399}
    .btn-ghost{appearance:none;border:1px solid var(--border);background:#fff;color:#111;}
    .btn-ghost:hover{background:#f2f4f7}

    /* Categorias (acordeões) */
    #categorias{ margin-top: 10px; }
    .cat{
      background:var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow);
      margin:12px 0; overflow:hidden; scroll-margin-top: var(--snap-offset);
    }
    .cat > summary{
      list-style:none; cursor:pointer; padding:10px 14px; font-weight:800; color:var(--primary);
      display:flex; align-items:center; justify-content:space-between;
    }
    .cat > summary::-webkit-details-marker{ display:none; }
    .cat[open] > summary{ background:#fff7d6; }
    .cat-count{ font-weight:700; background:#0f172a0d; color:#0f172a; padding:2px 8px; border-radius:999px; font-size:12px; }

    .cat-body{ padding: 10px 14px; }
    .option-card{
      background:#fff;border:1px solid var(--border);border-radius:10px;box-shadow:var(--shadow);
      padding:12px 14px;margin:10px 0;position:relative;
    }
    .opt-title{font-weight:700; margin:0 0 6px 0; color:#0f172a}
    .opt-desc{margin:0; color:#1f2937}
    .actions{margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .btn-select.is-selected{ background: var(--success); color:#fff; border-color:#168a44; }
    .btn-select.is-selected:hover{ filter:brightness(.95); }

    /* Prévia do Prompt */
    .preview{
      background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow);
      padding:12px 14px; margin:16px 0 6px;
    }
    #saida{ width:100%; min-height:220px; resize:vertical; border:1px solid var(--border); border-radius:10px; padding:10px 12px; font-size:13px; }

    /* Barra seleção (flutuante) */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#111;color:#fff;
      padding:8px 12px;border-radius:999px;opacity:0;transition:.2s;z-index:60}
    .toast.show{opacity:1}
    #bar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(10px + var(--safe-bottom)); z-index:9999; background:#111; color:#fff;
      padding:8px 10px; border-radius:12px; display:none; align-items:center; gap:8px;
      box-shadow:0 6px 20px rgba(0,0,0,.25); font: 500 13px/1.2 var(--font);
      pointer-events:none;
    }
    #bar button{
      pointer-events:auto;
      padding:var(--btn-pad-y) var(--btn-pad-x); border-radius:8px;
      border:1px solid var(--border); min-height:var(--btn-min-h); min-width:var(--btn-min-w); font-size:var(--btn-font);
    }
    #bar .go{ background: var(--primary); color:#fff; border-color:#0f2a71; }
    #bar .go:hover{ background:#264399 }
    #bar .clear{ background:#fff; color:#111; }
    #bar .clear:hover{ background:#f2f4f7 }

    @media (max-width: 600px){
      .actions{ gap:8px; }
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar__inner">
      <a class="brand" href="index.html" aria-label="Início">
        <img class="brand__logo" src="icons/logo.png" alt="direito.love" />
      </a>
      <nav class="topbar__actions" aria-label="Ações">
        <a class="chip" href="index.html">Prompt</a>
        <a class="chip" href="pesquisa.html">Pesquisar</a>
      </nav>
    </div>
  </header>

  <div class="wrap">
    <h2>Criador de Prompts para Estudantes de Direito</h2>
    <div id="importNotice" class="notice">Pronto. Agora é só escolher os objetivos do seu estudo e gerar o prompt.</div>

    <p>Digite o <b>Tema</b>, escolha as seções (cards) que deseja incluir e clique em <b>Gerar Prompt</b>.</p>

    <div class="tema-wrap">
      <textarea id="tema" placeholder="Ex.: Responsabilidade civil por erro médico no atendimento de emergência — art. 37, §6º, CF; CDC; jurisprudência do STJ..."></textarea>
      <div class="row">
        <button id="btnLimparTema" class="btn-ghost">Limpar Tema</button>
      </div>
    </div>

    <!-- Categorias -->
    <section id="categorias"></section>

    <!-- Prévia do Prompt -->
    <div class="preview" id="preview" style="display:none">
      <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:6px">
        <strong style="color:var(--primary)">Prévia do Prompt</strong>
        <div class="row">
          <button id="btnCopiarSaida" class="btn">Copiar</button>
          <button id="btnLimparSaida" class="btn-ghost">Limpar</button>
        </div>
      </div>
      <textarea id="saida"></textarea>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite"></div>

  <!-- Barra flutuante -->
  <div id="bar" aria-live="polite">
    <span id="count"></span>
    <button id="go" class="go">Gerar Prompt</button>
    <button id="clear" class="clear">Limpar</button>
  </div>

<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const $$=(s,r=document)=>[...r.querySelectorAll(s)];
  const toast=(m,t=1600)=>{const el=$("#toast");el.textContent=m;el.classList.add("show");setTimeout(()=>el.classList.remove("show"),t);};
  const wrap=$(".wrap");

  // ---------- Data: categorias e opções ----------
  const CATS = [
    {
      id:'fund', label:'Fundamentos', items:[
        {id:'conceitos', label:'Conceitos e Definições', desc:'Definições objetivas, linguagem clara e diferenciações essenciais, com 1–2 exemplos curtos.'},
        {id:'base-legal', label:'Base Legal Essencial', desc:'Listar artigos pertinentes (nº + ementa curtíssima) e diplomas aplicáveis. Sem transcrição integral.'},
        {id:'doutrina', label:'Doutrina Relevante', desc:'Síntese de 2–3 autores e suas posições. Referência bibliográfica abreviada.'},
      ]
    },
    {
      id:'precedentes', label:'Precedentes e Enunciados', items:[
        {id:'juris-maj', label:'Jurisprudência Majoritária', desc:'Tese dominante (STJ/STF) + 2–4 precedentes (número + ideia central).'},
        {id:'sumulas', label:'Súmulas e Enunciados', desc:'Súmulas/Enunciados relevantes (nº + tese) — STF/STJ/TSE/FPPC/CJF.'},
        {id:'leading', label:'Casos Famosos / Leading Cases', desc:'3–5 casos paradigmáticos e a contribuição de cada um.'},
      ]
    },
    {
      id:'analise', label:'Análise e Estratégia', items:[
        {id:'raciocinio', label:'Raciocínio Jurídico (passo a passo)', desc:'Fluxo lógico (if/then) para resolver o caso, com premissas e conclusão.'},
        {id:'quadro-comp', label:'Quadro Comparativo', desc:'Tabela simples: critérios x alternativas, vantagens/risco/efeito.'},
        {id:'debates', label:'Debates, Críticas e Tendências', desc:'Controvérsias, críticas doutrinárias e tendências jurisprudenciais.'},
        {id:'atualiz', label:'Atualizações Recentes', desc:'Mudanças relevantes (últimos 12–24 meses) — leis e julgados.'},
        {id:'erros', label:'Erros Comuns', desc:'Armadilhas e confusões frequentes; como evitar.'},
      ]
    },
    {
      id:'pratica', label:'Prática Processual', items:[
        {id:'modelo', label:'Estrutura de Peça / Modelos', desc:'Esqueleto com seções obrigatórias e frases-modelo editáveis.'},
        {id:'check-peca', label:'Checklist de Peça', desc:'Checklist antes de protocolar: requisitos formais e materiais.'},
        {id:'casos', label:'Exemplos e Casos Práticos', desc:'Cenários hipotéticos curtos mostrando aplicação do direito.'},
      ]
    },
    {
      id:'estudo', label:'Estudo & Provas', items:[
        {id:'mapa', label:'Mapa Mental', desc:'Organograma textual (bullets hierárquicos) do tema.'},
        {id:'flash', label:'Flashcards', desc:'Cartões Q/A curtos para memorização.'},
        {id:'questoes', label:'Questões de Fixação', desc:'5–10 questões objetivas/discursivas; gabarito ao final.'},
        {id:'check-final', label:'Checklist Final de Revisão', desc:'Checklist rápido para revisão pré-prova.'},
        {id:'dicas', label:'Dicas de Prova (OAB/Concursos)', desc:'Estratégias, pegadinhas típicas e gestão de tempo.'},
      ]
    },
    {
      id:'refs', label:'Referências', items:[
        {id:'bibliog', label:'Referências Bibliográficas', desc:'Lista comentada de obras e artigos para aprofundar.'},
      ]
    }
  ];

  // Instruções (como a IA deve entregar cada seção)
  const DIRECTIVES = {
    'conceitos': 'Faça definições diretas, compare com institutos próximos e ilustre com 1–2 exemplos breves.',
    'base-legal': 'Liste artigos (nº + ementa curtíssima) e diplomas; evite transcrever integral. Cite seções específicas quando útil.',
    'doutrina': 'Resuma 2–3 posições doutrinárias com referência abreviada (Autor, Obra, ano/página quando possível).',
    'juris-maj': 'Traga a tese dominante (STJ/STF) e 2–4 julgados com número e ideia central, em bullets.',
    'sumulas': 'Liste súmulas/enunciados relevantes com nº e tese, agrupando por tribunal/comissão.',
    'leading': 'Selecione 3–5 leading cases; para cada um: contexto, holding e impacto.',
    'raciocinio': 'Apresente o raciocínio em passos: fatos → norma → subsunção → conclusão, usando if/then.',
    'quadro-comp': 'Monte uma tabela simples (texto) comparando critérios-chave entre alternativas.',
    'debates': 'Aponte controvérsias, críticas e tendências; indique prós/cons de cada posição.',
    'atualiz': 'Liste alterações legislativas e julgados relevantes nos últimos 12–24 meses.',
    'erros': 'Liste armadilhas comuns e como evitá-las, de forma objetiva.',
    'modelo': 'Entregue um esqueleto de peça com cabeçalho, fatos, fundamentos, pedidos e fechamento; inclua frases-modelo.',
    'check-peca': 'Faça um checklist passo a passo para validação antes de protocolar.',
    'casos': 'Crie 2–3 cenários práticos curtos mostrando a aplicação do tema.',
    'mapa': 'Produza um mapa mental textual com bullets hierárquicos.',
    'flash': 'Crie 8–12 flashcards (pergunta → resposta curta).',
    'questoes': 'Redija 5–10 questões objetivas/discursivas e traga o gabarito ao final.',
    'check-final': 'Checklist conciso de revisão para provas.',
    'dicas': 'Dê estratégias de prova, pegadinhas típicas e gestão de tempo.',
    'bibliog': 'Liste referências essenciais (livros/artigos) com breve comentário de utilidade.'
  };

  // ---------- UI: render categorias ----------
  const categoriasEl = $("#categorias");
  const selected = new Set();

  function render(){
    categoriasEl.innerHTML = '';
    for(const cat of CATS){
      const det = document.createElement('details');
      det.className='cat';
      det.dataset.cat = cat.id;

      const sum = document.createElement('summary');
      const title = document.createElement('span'); title.textContent = cat.label;
      const count = document.createElement('span'); count.className='cat-count'; count.textContent = cat.items.length;
      sum.appendChild(title); sum.appendChild(count);
      det.appendChild(sum);

      const body = document.createElement('div'); body.className='cat-body';

      for(const it of cat.items){
        const card = document.createElement('div'); card.className='option-card'; card.dataset.id=it.id;

        const h = document.createElement('p'); h.className='opt-title'; h.textContent = it.label;
        const d = document.createElement('p'); d.className='opt-desc'; d.textContent = it.desc;

        const actions = document.createElement('div'); actions.className='actions';
        const btnSel = document.createElement('button'); btnSel.className='btn-alt btn-select'; btnSel.textContent='Selecionar';
        const sync = ()=>{
          const on = selected.has(it.id);
          btnSel.textContent = on ? 'Selecionado' : 'Selecionar';
          btnSel.classList.toggle('is-selected', on);
          updateBar();
        };
        btnSel.addEventListener('click', ()=>{
          if(selected.has(it.id)) selected.delete(it.id); else selected.add(it.id);
          sync();
        });

        actions.appendChild(btnSel);

        card.appendChild(h); card.appendChild(d); card.appendChild(actions);
        body.appendChild(card);
        sync();
      }

      det.appendChild(body);
      categoriasEl.appendChild(det);
    }
  }

  // ---------- Barra flutuante ----------
  function updateBar(){
    const n = selected.size;
    $("#count").textContent = n ? `Selecionados: ${n}` : '';
    const bar = $("#bar");
    bar.style.display = n ? 'flex' : 'none';
    wrap.style.paddingBottom = n ? `calc(var(--bar-h) + 14px + var(--safe-bottom))` : '22px';
  }
  $("#clear").addEventListener('click', ()=>{
    selected.clear();
    [...$$('.btn-select')].forEach(b=>{ b.classList.remove('is-selected'); b.textContent='Selecionar'; });
    updateBar();
  });

  // ---------- Importar direto da pesquisa ----------
  const KEY='dl_pesquisa_selecionados';
  function readPesquisa(){
    try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch{ return []; }
  }
  function autoImportFromPesquisa(){
    const arr = readPesquisa();
    const t = $("#tema");
    const parts = (arr||[]).map(x=> (x.texto||'').trim() ).filter(Boolean);
    if(parts.length){
      // Cola DIRETO no campo Tema, substituindo o conteúdo atual
      t.value = parts.join('\n\n');
      // Mostra aviso acima do campo
      $("#importNotice").classList.add('show');
      // Foca no tema para parecer "digitado" e posiciona o cursor no fim
      t.focus();
      t.selectionStart = t.selectionEnd = t.value.length;
    }
  }
  // dispara auto-import apenas quando veio da pesquisa
  if(location.hash === '#pesquisa'){ autoImportFromPesquisa(); }

  $("#btnLimparTema").addEventListener('click', ()=>{ $("#tema").value=''; $("#importNotice").classList.remove('show'); });

  // ---------- Gerar Prompt (agora inclui título + descrição + instruções) ----------
  function buildPrompt(){
    const tema = ($("#tema").value||'').trim();
    if(!tema){ toast('Informe o Tema.'); return ''; }
    if(!selected.size){ toast('Selecione pelo menos um card.'); return ''; }

    // Ordem conforme UI
    const order = [];
    for(const cat of CATS) for(const it of cat.items) if(selected.has(it.id)) order.push(it);

    const lines = [];
    lines.push('Você é uma IA jurídica. Produza uma resposta estruturada, objetiva e bem referenciada.');
    lines.push('');
    lines.push(`TEMA: ${tema}`);
    lines.push('');
    lines.push('INSTRUÇÕES GERAIS:');
    lines.push('- Use linguagem clara, precisa e técnica quando necessário.');
    lines.push('- Traga referências (artigos, súmulas, precedentes) de forma concisa.');
    lines.push('- Evite transcrições longas; foque em síntese e aplicabilidade prática.');
    lines.push('- Quando couber, liste em bullets e destaque passos/checagens.');
    lines.push('');

    for(const it of order){
      lines.push(`## ${it.label}`);
      if(it.desc) lines.push(`Descrição: ${it.desc}`);
      if(DIRECTIVES[it.id]) lines.push(`Instruções para a IA: ${DIRECTIVES[it.id]}`);
      lines.push(''); // linha em branco entre seções
    }

    lines.push('FORMATAÇÃO: Use subtítulos claros (##), bullets quando adequado e destaque números de artigos/precedentes.');
    return lines.join('\n');
  }

  $("#go").addEventListener('click', ()=>{
    const txt = buildPrompt();
    if(!txt) return;
    $("#saida").value = txt;
    $("#preview").style.display = 'block';
    $("#saida").scrollIntoView({behavior:'smooth', block:'start'});
  });

  $("#btnCopiarSaida").addEventListener('click', async()=>{
    try{ await navigator.clipboard.writeText($("#saida").value||''); toast('Prompt copiado!'); }
    catch{ toast('Erro ao copiar.'); }
  });
  $("#btnLimparSaida").addEventListener('click', ()=>{ $("#saida").value=''; });

  // ---------- Boot ----------
  render();
})();
</script>
</body>
</html>
